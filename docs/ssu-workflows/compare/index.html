<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="Workflows for processing 16S rRNA shrimp and environmental sample data sets using paired end reads, beginning with raw fastq files, ending with sequence and taxonomy tables.">
<title>3. OTU Workflow â€“ TransIsthmian Shrimp</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>

      .quarto-title-block .quarto-title-banner {
        background: #113858;
      }
</style>
<script src="../../../site_libs/kePrint-0.0.1/kePrint.js"></script><link href="../../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link rel="stylesheet" href="../../../assets/css/styles.css">
</head>
<body class="nav-sidebar floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/icon.png" alt="" class="navbar-logo"></a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item compact">
    <a class="nav-link" href="../../../index.html"> <i class="bi bi-home" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../../docs/data/index.html" aria-current="page"> 
<span class="menu-text">Data &amp; Scripts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../docs/ssu-workflows/index.html"> 
<span class="menu-text">16S rRNA</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../docs/mg-workflows/index.html"> 
<span class="menu-text">Metagenomics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../docs/pub/index.html"> 
<span class="menu-text">Paper</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/istmobiome/trans-shrimp/"> <i class="bi bi-github" role="img" aria-label="TransI-Shrimp">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../../about.html"> <i class="bi bi-lightbulb-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">3. OTU Workflow</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">3. OTU Workflow</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i></button></div></div>
                  <div>
        <div class="description">
          <p>Workflows for processing 16S rRNA shrimp and environmental sample data sets using paired end reads, beginning with raw fastq files, ending with sequence and taxonomy tables.</p>
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data &amp; Scripts</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../docs/ssu-workflows/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">16S rRNA Processing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/ssu-workflows/sampledata/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Sample Metadata</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/ssu-workflows/asv/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. ASV Workflow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/ssu-workflows/otu/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. OTU Workflow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/ssu-workflows/med/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. MED Workflow</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../docs/mg-workflows/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metagenomics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/mg-workflows/setup/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Annotation Databases</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/mg-workflows/assembly/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Co-Assembly &amp; Annotations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/mg-workflows/aa-results/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Assembly &amp; Annotation Results</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../docs/pub/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Publication Material</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/pub/references/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Workflow References</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/pub/submitdata/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Submitting Data</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#rename-na-taxonomic-ranks" id="toc-rename-na-taxonomic-ranks" class="nav-link active" data-scroll-target="#rename-na-taxonomic-ranks">Rename NA taxonomic ranks</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/istmobiome/trans-shrimp/edit/main/docs/ssu-workflows/compare/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/istmobiome/trans-shrimp/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/istmobiome/trans-shrimp/blob/main/docs/ssu-workflows/compare/index.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content"><div class="cell">
<details class="code-fold"><summary>Click here for page build libraries and setup information.</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>echo <span class="op">=</span> <span class="cn">TRUE</span>, eval <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">919191</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://benjjneb.github.io/dada2/">dada2</a></span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"dada2"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/ShortRead">ShortRead</a></span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"ShortRead"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/Biostrings">Biostrings</a></span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"Biostrings"</span><span class="op">)</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">tidyverse</span>, <span class="va">gridExtra</span>, <span class="va">grid</span>, <span class="va">miaViz</span>,</span>
<span>               <span class="va">formatR</span>, <span class="va">reactable</span>, <span class="va">gdata</span>, <span class="va">patchwork</span>,</span>
<span>               <span class="va">kableExtra</span>, <span class="va">microeco</span>, <span class="va">magrittr</span>, </span>
<span>               <span class="va">rprojroot</span>,</span>
<span>               <span class="va">tidySummarizedExperiment</span>, <span class="va">scater</span>,</span>
<span>               install <span class="op">=</span> <span class="cn">FALSE</span>, update <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_current</a></span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"cache"</span>,</span>
<span>  <span class="st">"cache.path"</span>,</span>
<span>  <span class="st">"cache.rebuild"</span>,</span>
<span>  <span class="st">"dependson"</span>,</span>
<span>  <span class="st">"autodep"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#root &lt;- find_root(has_file("_quarto.yml"))</span></span>
<span><span class="co">#source(file.path(root, "assets", "functions.R"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div class="cell">
<div class="cell-output-display">
<table class="table table-bordered table-condensed caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Code chunk coloring by language</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Color</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Language</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left; color: rgba(245, 245, 245, 255) !important;"><span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: rgba(0, 114, 178, 255) !important;margin: -6px; padding: 6px; display: flex;">blue</span></td>
<td style="text-align: center; font-weight: bold;">R</td>
</tr>
<tr class="even">
<td style="text-align: left; color: rgba(245, 245, 245, 255) !important;"><span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: rgba(213, 94, 0, 255) !important;margin: -6px; padding: 6px; display: flex;">vermillion</span></td>
<td style="text-align: center; font-weight: bold;">bash</td>
</tr>
<tr class="odd">
<td style="text-align: left; color: rgba(245, 245, 245, 255) !important;"><span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: rgba(0, 158, 115, 255) !important;margin: -6px; padding: 6px; display: flex;">bluish green</span></td>
<td style="text-align: center; font-weight: bold;">shell</td>
</tr>
<tr class="even">
<td style="text-align: left; color: rgba(245, 245, 245, 255) !important;"><span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: rgba(204, 121, 167, 255) !important;margin: -6px; padding: 6px; display: flex;">reddish purple</span></td>
<td style="text-align: center; font-weight: bold;">mothur</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We make use of many different coding languages in these workflows. Code chucks are colored by language.</p>
</div></div><div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/Biostrings">Biostrings</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/Biostrings">Biostrings</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span><span class="co">################################################################################</span></span>
<span><span class="co">########### READ IN THE MAPPING FILE FROM mothur2oligo #########################</span></span>
<span><span class="co">################################################################################</span></span>
<span><span class="va">id_map</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span><span class="st">"../pipelineFiles_med/BACTERIA_ONLY/intermediate2"</span>, </span>
<span>                            delim <span class="op">=</span> <span class="st">"\t"</span>, </span>
<span>                            col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">id_map</span> <span class="op">&lt;-</span> <span class="va">id_map</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"MOTHUR_ID"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"MED_ID"</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">id_map</span><span class="op">$</span><span class="va">MOTHUR_ID_RED</span> <span class="op">&lt;-</span> <span class="va">id_map</span><span class="op">$</span><span class="va">MOTHUR_ID</span></span>
<span><span class="va">id_map</span> <span class="op">&lt;-</span> <span class="va">id_map</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="st">"MOTHUR_ID_RED"</span>,<span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"_\\d+$"</span>,<span class="st">""</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">id_map</span><span class="op">$</span><span class="va">MOTHUR_UID</span> <span class="op">&lt;-</span> <span class="va">id_map</span><span class="op">$</span><span class="va">MOTHUR_ID</span></span>
<span><span class="va">id_map</span> <span class="op">&lt;-</span> <span class="va">id_map</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="st">"MOTHUR_UID"</span>,<span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">".*_"</span>,<span class="st">""</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">################################################################################</span></span>
<span><span class="co">########### READ IN THE OTU LIST FROM MOTHUR ###################################</span></span>
<span><span class="co">########### get.otulist(list=final.opti_mcc.list, sort=name) ###################</span></span>
<span><span class="co">################################################################################</span></span>
<span><span class="va">otu_list</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span><span class="st">"final.opti_mcc.0.03.otu"</span>, </span>
<span>                              delim <span class="op">=</span> <span class="st">"\t"</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">otu_list</span> <span class="op">&lt;-</span> <span class="va">otu_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"MOTHUR_ID"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>                         <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"MOTHUR_OTU"</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">################################################################################</span></span>
<span><span class="co">########### FUNCTION TO READ IN FASTA FILES  ###################################</span></span>
<span><span class="co">################################################################################</span></span>
<span><span class="va">get_fasta_headers</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file_path</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Read the FASTA file</span></span>
<span>    <span class="va">fasta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Biostrings/man/XStringSet-io.html">readDNAStringSet</a></span><span class="op">(</span><span class="va">file_path</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Extract and return the headers</span></span>
<span>    <span class="va">headers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">fasta</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">headers</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">################################################################################</span></span>
<span><span class="va">fa_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">"NODES/"</span>, pattern <span class="op">=</span> <span class="st">".fa"</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">seqmatch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">total_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">fa_files</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"ALL_RESULTS"</span><span class="op">)</span><span class="op">)</span>  </span>
<span><span class="co">################################################################################</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">fa_files</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_fasta_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"NODES/"</span>, <span class="va">fa_files</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="co">#tmp_fasta_file &lt;- paste0("NODES/", j)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Processing file %d of %d: %s\n"</span>, <span class="va">j</span>, <span class="va">total_files</span>, <span class="va">tmp_fasta_file</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_input_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">get_fasta_headers</span><span class="op">(</span><span class="va">tmp_fasta_file</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_input_ids</span> <span class="op">&lt;-</span> <span class="va">tmp_input_ids</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"MED_ID"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  </span>
<span>  <span class="va">tmp_input_ids</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">tmp_input_ids</span><span class="op">)</span></span>
<span>  <span class="va">tmp_1</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_input_ids</span>, <span class="va">id_map</span>, by <span class="op">=</span> <span class="st">"MED_ID"</span><span class="op">)</span> </span>
<span>  <span class="va">tmp_2</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">tmp_1</span><span class="op">)</span>, </span>
<span>                            <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">otu_list</span><span class="op">)</span>, </span>
<span>                            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"MOTHUR_ID_RED"</span> <span class="op">=</span> <span class="st">"MOTHUR_ID"</span> <span class="op">)</span>, </span>
<span>                            keep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">tmp_summ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html">table</a></span><span class="op">(</span><span class="va">tmp_2</span><span class="op">$</span><span class="va">MOTHUR_OTU</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_summ</span><span class="op">$</span><span class="va">file_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/path.html">basename</a></span><span class="op">(</span><span class="va">tmp_fasta_file</span><span class="op">)</span>, <span class="st">".fa"</span>, <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_base_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/path.html">basename</a></span><span class="op">(</span><span class="va">tmp_fasta_file</span><span class="op">)</span>, <span class="st">".fa"</span>, <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_delim</a></span><span class="op">(</span><span class="va">tmp_2</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="st">"ALL_RESULTS/"</span>, <span class="va">tmp_base_name</span>, <span class="st">".txt"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, </span>
<span>              delim <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span>
<span>  <span class="va">seqmatch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/cbind.html">rbind</a></span><span class="op">(</span><span class="va">seqmatch</span>, <span class="va">tmp_summ</span><span class="op">)</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">seqmatch</span> <span class="op">&lt;-</span> <span class="va">seqmatch</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"MOTHUR_OTU"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"COUNT"</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"MED_NODE"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> </span>
<span><span class="va">seqmatch</span><span class="op">$</span><span class="va">MOTHUR_OTU</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">seqmatch</span><span class="op">$</span><span class="va">MOTHUR_OTU</span><span class="op">)</span></span>
<span><span class="va">seqmatch</span><span class="op">$</span><span class="va">MOTHUR_OTU</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">seqmatch</span><span class="op">$</span><span class="va">MOTHUR_OTU</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"NO_OTU"</span></span>
<span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_delim</a></span><span class="op">(</span><span class="va">seqmatch</span>, <span class="st">"seqmatch.txt"</span>, delim <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">seqmatch</span>, <span class="st">"seqmatch.rds"</span><span class="op">)</span></span>
<span><span class="co">#save.image("seqmatch_workflow.rdata")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">seqmatch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"files/rdata/seqmatch.rds"</span><span class="op">)</span></span>
<span><span class="va">seqmatch</span><span class="op">$</span><span class="va">MED_NODE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="st">"MED"</span>, <span class="va">seqmatch</span><span class="op">$</span><span class="va">MED_NODE</span>, sep <span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#seqmatch$UNIQUE_ID &lt;- paste0(seqmatch$MED_NODE, "-", seqmatch$MOTHUR_OTU)</span></span>
<span><span class="va">seqmatch</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load necessary packages</span></span>
<span></span>
<span><span class="va">calculate_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">max_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">COUNT</span><span class="op">)</span></span>
<span>  <span class="va">no_otu_val</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">COUNT</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">MOTHUR_OTU</span> <span class="op">==</span> <span class="st">"NO_OTU"</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">sum_non_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">COUNT</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">COUNT</span> <span class="op">!=</span> <span class="va">max_val</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">adjusted_sum_non_max</span> <span class="op">&lt;-</span> <span class="va">sum_non_max</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">no_otu_val</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="va">no_otu_val</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    max_value <span class="op">=</span> <span class="va">max_val</span>,</span>
<span>    combined_others <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">MOTHUR_OTU</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/order.html">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">data</span><span class="op">$</span><span class="va">COUNT</span><span class="op">)</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,</span>
<span>    no_otu_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">no_otu_val</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="va">no_otu_val</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    sum_non_max_values <span class="op">=</span> <span class="va">sum_non_max</span>,</span>
<span>    adjusted_sum_non_max <span class="op">=</span> <span class="va">adjusted_sum_non_max</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Apply the function to each group and combine results</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">seqmatch</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">MED_NODE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/do.html">do</a></span><span class="op">(</span><span class="fu">calculate_summary</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="va">seqmatch</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">me_ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"me_asv_tmp"</span>, <span class="st">"me_otu_tmp"</span>, <span class="st">"me_med_tmp"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">me_ds</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/get.html">get</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="va">tmp_get</span><span class="op">$</span><span class="va">tax_table</span></span>
<span>  <span class="va">tmp_samp</span> <span class="op">&lt;-</span> <span class="va">tmp_get</span><span class="op">$</span><span class="va">sample_table</span></span>
<span>  <span class="va">tmp_st</span> <span class="op">&lt;-</span> <span class="va">tmp_get</span><span class="op">$</span><span class="va">otu_table</span></span>
<span>  <span class="va">tmp_fasta</span> <span class="op">&lt;-</span> <span class="va">tmp_get</span><span class="op">$</span><span class="va">rep_fasta</span></span>
<span></span>
<span>   <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html">nrow</a></span><span class="op">(</span><span class="va">tmp_tax</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>       <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_tax</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"p__Proteobacteria"</span> <span class="op">&amp;</span> <span class="va">tmp_tax</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"c__Alphaproteobacteria"</span><span class="op">)</span><span class="op">{</span></span>
<span>           <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p__Alphaproteobacteria"</span><span class="op">)</span></span>
<span>           <span class="va">tmp_tax</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>   <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_tax</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"p__Proteobacteria"</span> <span class="op">&amp;</span> <span class="va">tmp_tax</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"c__Gammaproteobacteria"</span><span class="op">)</span><span class="op">{</span></span>
<span>           <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p__Gammaproteobacteria"</span><span class="op">)</span></span>
<span>           <span class="va">tmp_tax</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>   <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_tax</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"p__Proteobacteria"</span> <span class="op">&amp;</span> <span class="va">tmp_tax</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"c__Epsilonproteobacteria"</span><span class="op">)</span><span class="op">{</span></span>
<span>           <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p__Epsilonproteobacteria"</span><span class="op">)</span></span>
<span>           <span class="va">tmp_tax</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>   <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_tax</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"p__Proteobacteria"</span> <span class="op">&amp;</span> <span class="va">tmp_tax</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"c__Zetaproteobacteria"</span><span class="op">)</span><span class="op">{</span></span>
<span>              <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p__Zetaproteobacteria"</span><span class="op">)</span></span>
<span>           <span class="va">tmp_tax</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>   <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_tax</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"p__Proteobacteria"</span> <span class="op">&amp;</span> <span class="va">tmp_tax</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"c__"</span><span class="op">)</span><span class="op">{</span></span>
<span>           <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p__Proteobacteria"</span><span class="op">)</span></span>
<span>           <span class="va">tmp_tax</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>       <span class="op">}</span></span>
<span>   <span class="op">}</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">j</span>, <span class="st">"_tmp"</span>, <span class="st">"_pb"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_me</span> <span class="op">&lt;-</span> <span class="va">microtable</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>sample_table <span class="op">=</span> <span class="va">tmp_samp</span>, </span>
<span>                         otu_table <span class="op">=</span> <span class="va">tmp_st</span>, </span>
<span>                         tax_table <span class="op">=</span> <span class="va">tmp_tax</span><span class="op">)</span></span>
<span>                         </span>
<span>  <span class="va">tmp_me</span><span class="op">$</span><span class="va">rep_fasta</span> <span class="op">&lt;-</span> <span class="va">tmp_fasta</span></span>
<span>  <span class="va">tmp_me</span><span class="op">$</span><span class="fu">tidy_dataset</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_me</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">class</span>, <span class="va">order</span>, <span class="va">phylum</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_tmp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">i</span>,<span class="va">j</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">me_ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"me_asv"</span>, <span class="st">"me_otu"</span>, <span class="st">"me_med"</span>, </span>
<span>           <span class="st">"me_asv_pb"</span>, <span class="st">"me_otu_pb"</span>, <span class="st">"me_med_pb"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">me_ds</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/get.html">get</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">j</span>, <span class="st">"_asv"</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_get</span><span class="op">$</span><span class="fu">add_rownames2taxonomy</span><span class="op">(</span>use_name <span class="op">=</span> <span class="st">"ASV"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">j</span>, <span class="st">"_otu"</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_get</span><span class="op">$</span><span class="fu">add_rownames2taxonomy</span><span class="op">(</span>use_name <span class="op">=</span> <span class="st">"OTU"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">j</span>, <span class="st">"_med"</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_get</span><span class="op">$</span><span class="fu">add_rownames2taxonomy</span><span class="op">(</span>use_name <span class="op">=</span> <span class="st">"MED"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">me_ds</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/get.html">get</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get</span><span class="op">$</span><span class="va">auto_tidy</span> <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"files/rdata/"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">tmp_get</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">j</span>, <span class="st">".rds"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">me_asv_pb</span><span class="op">$</span><span class="va">tax_table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">me_ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"me_asv"</span>, <span class="st">"me_otu"</span>, <span class="st">"me_med"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">me_ds</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/get.html">get</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span></span>
<span>  <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="fu">microeco</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microeco/man/clone.html">clone</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span></span>
<span>  <span class="va">tmp_ds_df</span> <span class="op">&lt;-</span> <span class="va">tmp_ds</span><span class="op">$</span><span class="va">otu_table</span></span>
<span></span>
<span>  <span class="va">tmp_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">rownames</a></span><span class="op">(</span><span class="va">tmp_ds_df</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"\\d+"</span>, <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_type</span>, <span class="st">"_ID"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_ds_df</span> <span class="op">&lt;-</span> <span class="va">tmp_ds_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>total_reads <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, </span>
<span>           .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">tmp_ds_df</span> <span class="op">&lt;-</span> <span class="va">tmp_ds_df</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>total_reads_ES <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"E_SAMP"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>           .after <span class="op">=</span> <span class="st">"total_reads"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_ds_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">tmp_ds_df</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"E_SAMP"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_ds_df</span> <span class="op">&lt;-</span> <span class="va">tmp_ds_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>total_reads_SS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">.</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html">ncol</a></span><span class="op">(</span><span class="va">tmp_ds_df</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                  .after <span class="op">=</span> <span class="st">"total_reads_ES"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_ds_df</span> <span class="op">&lt;-</span> <span class="va">tmp_ds_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="va">tmp_type</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_ds_df</span><span class="op">[</span>, <span class="fl">5</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html">ncol</a></span><span class="op">(</span><span class="va">tmp_ds_df</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="va">tmp_ds_df</span> <span class="op">&lt;-</span> <span class="va">tmp_ds_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>perc_reads_in_ES <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="op">(</span></span>
<span>    <span class="va">total_reads_ES</span> <span class="op">/</span> <span class="op">(</span><span class="va">total_reads_ES</span> <span class="op">+</span> <span class="va">total_reads_SS</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                .after <span class="op">=</span> <span class="st">"total_reads_SS"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_ds_df</span><span class="op">$</span><span class="va">perc_reads_in_ES</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">tmp_ds_df</span><span class="op">$</span><span class="va">perc_reads_in_ES</span>, digits <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">j</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_df"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">#tmp_name &lt;- str_replace(j, "_tmp", "_df")</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_ds_df</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_df"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">me_ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"me_asv"</span>, <span class="st">"me_otu"</span>, <span class="st">"me_med"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">me_ds</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/get.html">get</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span></span>
<span>  <span class="va">tmp_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">$</span><span class="va">otu_table</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">rownames</a></span><span class="op">(</span><span class="va">tmp_1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"\\d+"</span>, <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_type</span>, <span class="st">"_ID"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_1</span> <span class="op">&lt;-</span> <span class="va">tmp_1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="va">tmp_type</span><span class="op">)</span></span>
<span>  <span class="va">tmp_1</span> <span class="op">&lt;-</span> <span class="va">tmp_1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"total_samples"</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>  </span>
<span></span>
<span>  <span class="va">tmp_2</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">$</span><span class="va">otu_table</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"E_SAMP"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_2</span><span class="op">$</span><span class="va">num_samp_ES</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">tmp_2</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">tmp_2</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">tmp_2</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"num_samp_ES"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_2</span> <span class="op">&lt;-</span> <span class="va">tmp_2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="va">tmp_type</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_3</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">$</span><span class="va">otu_table</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"E_SAMP"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_3</span><span class="op">$</span><span class="va">num_samp_SS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">tmp_3</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">tmp_3</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">tmp_3</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"num_samp_SS"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_3</span> <span class="op">&lt;-</span> <span class="va">tmp_3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="va">tmp_type</span><span class="op">)</span></span>
<span>  <span class="co">#tmp_merge &lt;- get(str_replace(j, "_tmp", "_df"))</span></span>
<span>  <span class="va">tmp_merge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">j</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_df"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_ds_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_merge</span>, <span class="va">tmp_1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                 <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                 <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_3</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_ds_df</span> <span class="op">&lt;-</span> <span class="va">tmp_ds_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>perc_samp_in_ES <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="op">(</span> <span class="va">num_samp_ES</span> <span class="op">/</span> <span class="op">(</span><span class="va">num_samp_ES</span> <span class="op">+</span> <span class="va">num_samp_SS</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                .after <span class="op">=</span> <span class="st">"num_samp_SS"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">j</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_df"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">#tmp_name &lt;- str_replace(j, "_tmp", "_df")</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_ds_df</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>me_ds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"me_asv_df"</span>, <span class="st">"me_otu_df"</span>, <span class="st">"me_med_df"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> me_ds) {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(j)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  tmp_ds_df <span class="ot">&lt;-</span> tmp_get <span class="sc">%&gt;%</span> <span class="fu">filter</span>(perc_reads_in_ES <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">|</span> perc_samp_in_ES <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  tmp_name_df <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(j, <span class="st">"_df"</span>, <span class="st">"_env"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_df, tmp_ds_df)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  tmp_rem <span class="ot">&lt;-</span> tmp_ds_df[,<span class="dv">1</span>] <span class="sc">%&gt;%</span>  <span class="fu">unlist</span>(<span class="fu">strsplit</span>(., <span class="at">split =</span> <span class="st">", "</span>)) </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(j, <span class="st">"_df"</span>, <span class="st">"_env_rem"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_rem)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>me_ds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"me_asv"</span>, <span class="st">"me_otu"</span>, <span class="st">"me_med"</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> me_ds) {</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(j)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  tmp_es <span class="ot">&lt;-</span> microeco<span class="sc">::</span><span class="fu">clone</span>(tmp_get)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  tmp_rem <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_env_rem"</span>)))</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  tmp_es<span class="sc">$</span>otu_table <span class="ot">&lt;-</span> tmp_es<span class="sc">$</span>otu_table <span class="sc">%&gt;%</span> </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="fu">row.names</span>(tmp_es<span class="sc">$</span>otu_table)  tmp_rem)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  tmp_es<span class="sc">$</span><span class="fu">tidy_dataset</span>()</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_es"</span>))</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_es)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_es"</span>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>tmp_asv <span class="ot">&lt;-</span> me_asv_es<span class="sc">$</span><span class="fu">merge_samples</span>(<span class="st">"TAXON"</span>)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>tmp_asv<span class="sc">$</span>otu_table</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>tmp_med <span class="ot">&lt;-</span> me_med_es<span class="sc">$</span><span class="fu">merge_samples</span>(<span class="st">"TAXON"</span>)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>tmp_med<span class="sc">$</span>tax_table</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>tmp_otu <span class="ot">&lt;-</span> me_otu_es<span class="sc">$</span><span class="fu">merge_samples</span>(<span class="st">"TAXON"</span>)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>tmp_otu<span class="sc">$</span>otu_table</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>me_asv_env</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">me_ds</span> <span class="op">&lt;-</span> <span class="fu">clone</span><span class="op">(</span><span class="va">me_med_pb</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="va">trans_alpha</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">me_ds</span>, group <span class="op">=</span> <span class="st">"TISSUE"</span><span class="op">)</span></span>
<span><span class="co"># return t1$data_stat</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="va">data_stat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">cal_diff</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"KW"</span><span class="op">)</span></span>
<span><span class="co"># return t1$res_diff</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="va">res_diff</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">cal_diff</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"KW_dunn"</span><span class="op">)</span></span>
<span><span class="co"># return t1$res_diff</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="va">res_diff</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># more options</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">cal_diff</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"KW_dunn"</span>, KW_dunn_letter <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="va">res_diff</span><span class="op">)</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">cal_diff</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"wilcox"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="va">res_diff</span><span class="op">)</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">cal_diff</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"t.test"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">cal_diff</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"anova"</span><span class="op">)</span></span>
<span><span class="co"># return t1$res_diff</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="va">res_diff</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="va">trans_alpha</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">me_ds</span>, group <span class="op">=</span> <span class="st">"TISSUE"</span><span class="op">)</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">cal_diff</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"anova"</span>, formula <span class="op">=</span> <span class="st">"TISSUE+OCEAN"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="va">res_diff</span><span class="op">)</span></span>
<span><span class="co"># see the help document for the usage of formula</span></span>
<span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">cal_diff</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"anova"</span><span class="op">)</span></span>
<span><span class="co"># y_increase can adjust the distance from the letters to the highest point</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">plot_alpha</span><span class="op">(</span>measure <span class="op">=</span> <span class="st">"Chao1"</span>, y_increase <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">plot_alpha</span><span class="op">(</span>measure <span class="op">=</span> <span class="st">"Chao1"</span>, y_increase <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co"># add_sig_text_size: letter size adjustment</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">plot_alpha</span><span class="op">(</span>measure <span class="op">=</span> <span class="st">"Chao1"</span>, add_sig_text_size <span class="op">=</span> <span class="fl">6</span>, add <span class="op">=</span> <span class="st">"jitter"</span>, order_x_mean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">cal_diff</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"wilcox"</span><span class="op">)</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">plot_alpha</span><span class="op">(</span>measure <span class="op">=</span> <span class="st">"Chao1"</span>, shape <span class="op">=</span> <span class="st">"TISSUE"</span><span class="op">)</span></span>
<span><span class="co"># y_start: starting height for the first label</span></span>
<span><span class="co"># y_increase: increased height for each label</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">plot_alpha</span><span class="op">(</span>measure <span class="op">=</span> <span class="st">"Chao1"</span>, shape <span class="op">=</span> <span class="st">"TISSUE"</span>, add <span class="op">=</span> <span class="st">"jitter"</span>, y_start <span class="op">=</span> <span class="fl">0.1</span>, y_increase <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="va">res_diff</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Significance</span> <span class="op">!=</span> <span class="st">"ns"</span><span class="op">)</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">plot_alpha</span><span class="op">(</span>measure <span class="op">=</span> <span class="st">"Chao1"</span>, add <span class="op">=</span> <span class="st">"dotplot"</span>, xtext_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="va">trans_alpha</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">me_ds</span>, group <span class="op">=</span> <span class="st">"OCEAN"</span>, by_group <span class="op">=</span> <span class="st">"TISSUE"</span><span class="op">)</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">cal_diff</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"wilcox"</span><span class="op">)</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">plot_alpha</span><span class="op">(</span>measure <span class="op">=</span> <span class="st">"Shannon"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">t1</span><span class="op">)</span></span>
<span><span class="va">me_ds</span><span class="op">$</span><span class="fu">cal_betadiv</span><span class="op">(</span>unifrac <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unique.html">unique</a></span><span class="op">(</span><span class="va">me_ds</span><span class="op">$</span><span class="va">sample_table</span><span class="op">$</span><span class="va">PAIR</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="va">trans_beta</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">me_ds</span>, group <span class="op">=</span> <span class="st">"TISSUE"</span>, measure <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">cal_ordination</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"PCoA"</span><span class="op">)</span></span>
<span><span class="co"># t1$res_ordination is the ordination result list</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="va">res_ordination</span><span class="op">)</span></span>
<span><span class="co"># plot the PCoA result with confidence ellipse</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">plot_ordination</span><span class="op">(</span>plot_color <span class="op">=</span> <span class="st">"TISSUE"</span>, plot_shape <span class="op">=</span> <span class="st">"OCEAN"</span>, plot_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"point"</span>, <span class="st">"ellipse"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>MERGE SAMPLES ANALYSIS</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">me_ds</span> <span class="op">&lt;-</span> <span class="fu">clone</span><span class="op">(</span><span class="va">me_med_pb</span><span class="op">)</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="va">trans_abund</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">me_ds</span>, taxrank <span class="op">=</span> <span class="st">"Phylum"</span>, ntaxa <span class="op">=</span> <span class="fl">10</span>, groupmean <span class="op">=</span> <span class="st">"TISSUE"</span><span class="op">)</span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="va">t1</span><span class="op">$</span><span class="fu">plot_bar</span><span class="op">(</span>others_color <span class="op">=</span> <span class="st">"grey70"</span>, legend_text_italic <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">g1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show 40 taxa at Genus level</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="va">trans_abund</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">me_ds</span>, taxrank <span class="op">=</span> <span class="st">"Phylum"</span>, ntaxa <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="va">t1</span><span class="op">$</span><span class="fu">plot_heatmap</span><span class="op">(</span>facet <span class="op">=</span> <span class="st">"TISSUE"</span>, xtext_keep <span class="op">=</span> <span class="cn">FALSE</span>, withmargin <span class="op">=</span> <span class="cn">FALSE</span>, plot_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g1</span></span>
<span><span class="va">g1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">'italic'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="va">trans_abund</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">me_ds</span>, taxrank <span class="op">=</span> <span class="st">"Phylum"</span>, ntaxa <span class="op">=</span> <span class="fl">6</span>, groupmean <span class="op">=</span> <span class="st">"TISSUE"</span><span class="op">)</span></span>
<span><span class="co"># all pie chart in one row</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">plot_pie</span><span class="op">(</span>facet_nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">plot_pie</span><span class="op">(</span>facet_nrow <span class="op">=</span> <span class="fl">3</span>, add_label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="va">trans_abund</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">me_ds</span>, taxrank <span class="op">=</span> <span class="st">"Phylum"</span>, ntaxa <span class="op">=</span> <span class="fl">8</span>, groupmean <span class="op">=</span> <span class="st">"TISSUE"</span><span class="op">)</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">plot_donut</span><span class="op">(</span>label <span class="op">=</span> <span class="cn">FALSE</span>, facet_nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">plot_donut</span><span class="op">(</span>label <span class="op">=</span> <span class="cn">TRUE</span>, facet_nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="va">trans_abund</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">me_ds</span>, taxrank <span class="op">=</span> <span class="st">"Phylum"</span>, ntaxa <span class="op">=</span> <span class="fl">10</span>, groupmean <span class="op">=</span> <span class="st">"SPECIES"</span><span class="op">)</span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="va">t1</span><span class="op">$</span><span class="fu">plot_bar</span><span class="op">(</span>coord_flip <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="va">g1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>, axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g1</span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="va">t1</span><span class="op">$</span><span class="fu">plot_bar</span><span class="op">(</span>clustering_plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># In this case, g1 (aplot object) is the combination of different ggplot objects</span></span>
<span><span class="co"># to adjust the main plot, please select g1[[1]]</span></span>
<span><span class="va">g1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">g1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>, axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g1</span></span>
<span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">me_ds</span><span class="op">$</span><span class="fu">merge_samples</span><span class="op">(</span><span class="st">"TISSUE"</span><span class="op">)</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="va">trans_venn</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span>
<span><span class="co"># only show some sets with large intersection numbers</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="va">data_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="va">.</span><span class="op">[</span><span class="va">.</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">20</span>, <span class="op">]</span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="va">t1</span><span class="op">$</span><span class="fu">plot_bar</span><span class="op">(</span>left_plot <span class="op">=</span> <span class="cn">TRUE</span>, bottom_height <span class="op">=</span> <span class="fl">0.5</span>, left_width <span class="op">=</span> <span class="fl">0.15</span>, up_bar_fill <span class="op">=</span> <span class="st">"grey50"</span>, left_bar_fill <span class="op">=</span> <span class="st">"grey50"</span>, bottom_point_color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="va">g1</span></span>
<span><span class="co"># g1 is aplot class and can be saved with ggplot2::ggsave, aplot::ggsave or cowplot::save_plot function</span></span>
<span><span class="co"># as g1 is comprised of several sub-plots, please adjust the details for each sub-plot</span></span>
<span><span class="va">g1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">g1</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">dataset1</span> <span class="op">&lt;-</span> <span class="va">me_ds</span><span class="op">$</span><span class="fu">merge_samples</span><span class="op">(</span><span class="st">"TISSUE"</span><span class="op">)</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="va">trans_venn</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">dataset1</span><span class="op">)</span></span>
<span><span class="co"># transform venn results to the sample-species table, here do not consider abundance, only use presence/absence.</span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span> <span class="va">t1</span><span class="op">$</span><span class="fu">trans_comm</span><span class="op">(</span>use_frequency <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># t2 is a new microtable class, each part is considered a sample</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">t2</span><span class="op">)</span></span>
<span><span class="co"># calculate taxa abundance, that is, the frequency</span></span>
<span><span class="va">t2</span><span class="op">$</span><span class="fu">cal_abund</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">t2</span><span class="op">$</span><span class="va">taxa_abund</span></span>
<span><span class="co"># transform and plot</span></span>
<span><span class="va">t3</span> <span class="op">&lt;-</span> <span class="va">trans_abund</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">t2</span>, taxrank <span class="op">=</span> <span class="st">"Phylum"</span>, ntaxa <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unique.html">unique</a></span><span class="op">(</span><span class="va">t3</span><span class="op">$</span><span class="va">data_abund</span><span class="op">$</span><span class="va">Sample</span><span class="op">)</span></span>
<span><span class="va">t3</span><span class="op">$</span><span class="fu">plot_bar</span><span class="op">(</span>bar_full <span class="op">=</span> <span class="cn">FALSE</span>, legend_text_italic <span class="op">=</span> <span class="cn">T</span>, xtext_angle <span class="op">=</span> <span class="fl">30</span>, color_values <span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">8</span>, <span class="st">"Set2"</span><span class="op">)</span>,</span>
<span>    order_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"IW"</span>, <span class="st">"CW"</span>, <span class="st">"TW"</span>, <span class="st">"IW&amp;CW"</span>, <span class="st">"IW&amp;TW"</span>, <span class="st">"CW&amp;TW"</span>, <span class="st">"IW&amp;CW&amp;TW"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Frequency (%)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unique.html">unique</a></span><span class="op">(</span><span class="va">t3</span><span class="op">$</span><span class="va">data_abund</span><span class="op">$</span><span class="va">Sample</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">me_ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"me_med"</span>, <span class="st">"me_asv"</span>, <span class="st">"me_otu"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">me_ds</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/get.html">get</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">$</span><span class="va">otu_table</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_tab</span> <span class="op">&lt;-</span> <span class="va">tmp_get_tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"ID"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_tab</span> <span class="op">&lt;-</span> <span class="fu">jamba</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamba/man/mixedSortDF.html">mixedSortDF</a></span><span class="op">(</span><span class="va">tmp_get_tab</span>, decreasing <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                                        useRownames <span class="op">=</span> <span class="cn">FALSE</span>, byCols <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_tab</span> <span class="op">&lt;-</span> <span class="va">tmp_get_tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">remove_rownames</a></span><span class="op">(</span><span class="op">)</span> </span>
<span>  <span class="va">tmp_get_tab</span> <span class="op">&lt;-</span> <span class="va">tmp_get_tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"ID"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/t.html">t</a></span><span class="op">(</span><span class="va">tmp_get_tab</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_get_tab_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">$</span><span class="va">otu_table</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_tab_ord</span> <span class="op">&lt;-</span> <span class="va">tmp_get_tab_ord</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"ID"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_tab_ord</span> <span class="op">&lt;-</span> <span class="fu">jamba</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamba/man/mixedSortDF.html">mixedSortDF</a></span><span class="op">(</span><span class="va">tmp_get_tab_ord</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                        useRownames <span class="op">=</span> <span class="cn">FALSE</span>, byCols <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_tab_ord</span> <span class="op">&lt;-</span> <span class="va">tmp_get_tab_ord</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">remove_rownames</a></span><span class="op">(</span><span class="op">)</span> </span>
<span>  <span class="va">tmp_get_tab_ord</span> <span class="op">&lt;-</span> <span class="va">tmp_get_tab_ord</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"ID"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_tab_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/t.html">t</a></span><span class="op">(</span><span class="va">tmp_get_tab_ord</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_tab_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">j</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_perfect"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_tab_name</span>, <span class="va">tmp_get_tab</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tmp_tab_ord_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">j</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_ord_perfect"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_tab_ord_name</span>, <span class="va">tmp_get_tab_ord</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_perfect"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">me_med_perfect</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">me_med_ord_perfect</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">me_asv_perfect</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">me_asv_ord_perfect</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">me_otu_perfect</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">me_otu_ord_perfect</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#me_ds &lt;- c("me_med", "me_asv", "me_otu")</span></span>
<span><span class="va">me_ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"me_med"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cxquy91/PERFect">PERFect</a></span><span class="op">)</span></span>
<span><span class="va">per_pval</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">me_ds</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"files/rdata/"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">j</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_perfect"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_pval</span> <span class="op">&lt;-</span> <span class="va">per_pval</span></span>
<span>  <span class="va">tmp_get_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">j</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_ord_perfect"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Running PERFect_sim on default"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PERFect/man/PERFect_sim.html">PERFect_sim</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">tmp_get</span>, alpha <span class="op">=</span> <span class="va">tmp_pval</span>, Order <span class="op">=</span> <span class="st">"NP"</span>, center <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Finished running PERFect_sim on default"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">tmp_sim</span><span class="op">$</span><span class="va">filtX</span><span class="op">)</span></span>
<span>  <span class="va">tmp_sim_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">j</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_perfect_sim"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_sim_name</span>, <span class="va">tmp_sim</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">tmp_sim</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">tmp_sim_name</span>, <span class="st">".rds"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Running PERFect_sim on Ordered"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_sim_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PERFect/man/PERFect_sim.html">PERFect_sim</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">tmp_get_ord</span>, alpha <span class="op">=</span> <span class="va">tmp_pval</span>, Order <span class="op">=</span> <span class="st">"NP"</span>, center <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">tmp_sim_ord</span><span class="op">$</span><span class="va">filtX</span><span class="op">)</span></span>
<span>  <span class="va">tmp_sim_ord_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">j</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_ord_perfect_sim"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Finished running PERFect_sim on Ordered"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_sim_ord_name</span>, <span class="va">tmp_sim_ord</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">tmp_sim_ord</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">tmp_sim_ord_name</span>, <span class="st">".rds"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_sim"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">me_med_ord_perfect_sim</span><span class="op">$</span><span class="va">filtX</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">me_med_perfect_sim</span><span class="op">$</span><span class="va">filtX</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">me_med_perfect_sim</span><span class="op">$</span><span class="va">pvals</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">me_med_ord_perfect_sim</span><span class="op">$</span><span class="va">pvals</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Total 16S rRNA ASVs with p-value less than"</span>, <span class="va">ssu_per_pval</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="va">ssu_default_pvals</span></span>
<span><span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_df</span><span class="op">)</span></span>
<span><span class="va">pval_asv</span> <span class="op">&lt;-</span> <span class="va">tmp_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tmp_df</span> <span class="op">&lt;=</span> <span class="va">ssu_per_pval</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="st">"default order: ASVs before checking p value was"</span>, </span>
<span>            <span class="va">ssu_default_num_asvs</span>, </span>
<span>            <span class="st">"and after was"</span>, </span>
<span>            <span class="va">pval_asv</span><span class="op">$</span><span class="va">count</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, </span>
<span>      quote <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"--------------------------------------"</span>, quote <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="va">ssu_ord_pvals</span></span>
<span><span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_df</span><span class="op">)</span></span>
<span><span class="va">pval_asv_ord</span> <span class="op">&lt;-</span> <span class="va">tmp_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tmp_df</span> <span class="op">&lt;=</span> <span class="va">ssu_per_pval</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="st">"decreasing order: ASVs before checking p value was"</span>, </span>
<span>            <span class="va">ssu_ord_num_asvs</span>, <span class="st">"and after was"</span>, </span>
<span>            <span class="va">pval_asv_ord</span><span class="op">$</span><span class="va">count</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, </span>
<span>      quote <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tmp_a</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">if_any</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">'OTU_132'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#prep for https://env-med.shinyapps.io/microbiem/</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="va">me_asv</span><span class="op">$</span><span class="va">tax_table</span></span>
<span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="va">tmp_tax</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_all</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"[a-z]__"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="va">tmp_tax</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="st">"Taxonomy"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, remove <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="va">tmp_tax</span>, <span class="st">"OTU_ID"</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">sapply</a></span><span class="op">(</span><span class="va">tmp_tax</span>, </span>
<span>                             <span class="va">gsub</span>, </span>
<span>                             pattern <span class="op">=</span> <span class="st">";+$"</span>, </span>
<span>                             replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span></span>
<span></span>
<span><span class="va">tmp_asv</span> <span class="op">&lt;-</span> <span class="va">me_asv</span><span class="op">$</span><span class="va">otu_table</span></span>
<span><span class="va">tmp_asv</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="va">tmp_asv</span>, <span class="st">"OTU_ID"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">asv_miem_feature</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_asv</span>, <span class="va">tmp_tax</span>, by <span class="op">=</span> <span class="st">"OTU_ID"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_delim</a></span><span class="op">(</span><span class="va">asv_miem_feature</span>, <span class="st">"asv_miem_feature.txt"</span>, delim <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_samp</span> <span class="op">&lt;-</span> <span class="va">me_asv</span><span class="op">$</span><span class="va">sample_table</span></span>
<span><span class="va">tmp_samp</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="va">tmp_samp</span>, <span class="st">"Sample_ID"</span><span class="op">)</span></span>
<span><span class="va">tmp_samp</span><span class="op">$</span><span class="va">SampleID</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">tmp_samp</span><span class="op">$</span><span class="va">Sample_type</span> <span class="op">&lt;-</span> <span class="st">"SAMPLE"</span></span>
<span><span class="va">asv_miem_sample</span> <span class="op">&lt;-</span> <span class="va">tmp_samp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">Sample_type</span>, .after <span class="op">=</span> <span class="st">"Sample_ID"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_delim</a></span><span class="op">(</span><span class="va">asv_miem_sample</span>, <span class="st">"asv_miem_sample.txt"</span>, delim <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#prep for https://env-med.shinyapps.io/microbiem/</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="va">me_asv</span><span class="op">$</span><span class="va">tax_table</span></span>
<span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="va">tmp_tax</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_all</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"[a-z]__"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="va">tmp_tax</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="st">"Taxonomy"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, remove <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="va">tmp_tax</span>, <span class="st">"OTU_ID"</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">sapply</a></span><span class="op">(</span><span class="va">tmp_tax</span>, </span>
<span>                             <span class="va">gsub</span>, </span>
<span>                             pattern <span class="op">=</span> <span class="st">";+$"</span>, </span>
<span>                             replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span></span>
<span></span>
<span><span class="va">tmp_asv</span> <span class="op">&lt;-</span> <span class="va">me_asv</span><span class="op">$</span><span class="va">otu_table</span></span>
<span><span class="va">tmp_asv</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="va">tmp_asv</span>, <span class="st">"OTU_ID"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">asv_miem_feature</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_asv</span>, <span class="va">tmp_tax</span>, by <span class="op">=</span> <span class="st">"OTU_ID"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_delim</a></span><span class="op">(</span><span class="va">asv_miem_feature</span>, <span class="st">"asv_miem_feature.txt"</span>, delim <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_samp</span> <span class="op">&lt;-</span> <span class="va">me_asv</span><span class="op">$</span><span class="va">sample_table</span></span>
<span><span class="va">tmp_samp</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="va">tmp_samp</span>, <span class="st">"Sample_ID"</span><span class="op">)</span></span>
<span><span class="va">tmp_samp</span><span class="op">$</span><span class="va">SampleID</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">tmp_samp</span><span class="op">$</span><span class="va">Sample_type</span> <span class="op">&lt;-</span> <span class="st">"SAMPLE"</span></span>
<span><span class="va">asv_miem_sample</span> <span class="op">&lt;-</span> <span class="va">tmp_samp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">Sample_type</span>, .after <span class="op">=</span> <span class="st">"Sample_ID"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_delim</a></span><span class="op">(</span><span class="va">asv_miem_sample</span>, <span class="st">"asv_miem_sample.txt"</span>, delim <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#prep for https://env-med.shinyapps.io/microbiem/</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="va">me_med</span><span class="op">$</span><span class="va">tax_table</span></span>
<span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="va">tmp_tax</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_all</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"[a-z]__"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="va">tmp_tax</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="st">"Taxonomy"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, remove <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="va">tmp_tax</span>, <span class="st">"OTU_ID"</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">sapply</a></span><span class="op">(</span><span class="va">tmp_tax</span>, </span>
<span>                             <span class="va">gsub</span>, </span>
<span>                             pattern <span class="op">=</span> <span class="st">";+$"</span>, </span>
<span>                             replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span></span>
<span></span>
<span><span class="va">tmp_asv</span> <span class="op">&lt;-</span> <span class="va">me_med</span><span class="op">$</span><span class="va">otu_table</span></span>
<span><span class="va">tmp_asv</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="va">tmp_asv</span>, <span class="st">"OTU_ID"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">med_miem_feature</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_asv</span>, <span class="va">tmp_tax</span>, by <span class="op">=</span> <span class="st">"OTU_ID"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_delim</a></span><span class="op">(</span><span class="va">med_miem_feature</span>, <span class="st">"med_miem_feature.txt"</span>, delim <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_samp</span> <span class="op">&lt;-</span> <span class="va">me_med</span><span class="op">$</span><span class="va">sample_table</span></span>
<span><span class="va">tmp_samp</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="va">tmp_samp</span>, <span class="st">"Sample_ID"</span><span class="op">)</span></span>
<span><span class="va">tmp_samp</span><span class="op">$</span><span class="va">SampleID</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">tmp_samp</span><span class="op">$</span><span class="va">Sample_type</span> <span class="op">&lt;-</span> <span class="va">tmp_samp</span><span class="op">$</span><span class="va">Sample_ID</span></span>
<span><span class="va">med_miem_sample</span> <span class="op">&lt;-</span> <span class="va">tmp_samp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">Sample_type</span>, .after <span class="op">=</span> <span class="st">"Sample_ID"</span><span class="op">)</span></span>
<span><span class="va">med_miem_sample</span> <span class="op">&lt;-</span> <span class="va">med_miem_sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="st">"Sample_type"</span>, <span class="va">str_replace</span>, <span class="st">"^.*E_SAMP.*"</span>, <span class="st">"POS1"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="st">"Sample_type"</span>, <span class="va">str_replace</span>, <span class="st">"^.*A_.*"</span>, <span class="st">"SAMPLE"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="st">"Sample_type"</span>, <span class="va">str_replace</span>, <span class="st">"^.*UNKN.*"</span>, <span class="st">"SAMPLE"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_delim</a></span><span class="op">(</span><span class="va">med_miem_sample</span>, <span class="st">"med_miem_sample.txt"</span>, delim <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html">citation</a></span><span class="op">(</span><span class="st">"microeco"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html">citation</a></span><span class="op">(</span><span class="st">"mia"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="rename-na-taxonomic-ranks" class="level2"><h2 class="anchored" data-anchor-id="rename-na-taxonomic-ranks">Rename NA taxonomic ranks</h2>
<p>Phyloseq has an odd way of dealing with taxonomic ranks that have no valueâ€”in other words, <strong>NA</strong> in the tax table. The first thing we are going to do before moving forward is to change all of the <em>NA</em>s to have a value of the next highest classified rank. For example, <code>ASV26</code> is not classified at the Genus level but is at Family level (Xanthobacteraceae). So we change the Genus name to <em>Family_Xanthobacteraceae</em>. The code for comes from these two posts on the phyloseq GitHub, both by <a href="https://github.com/MSMortensen">MSMortensen</a>: issue <a href="https://github.com/joey711/phyloseq/issues/850#issuecomment-394771087">#850</a> and issue <a href="https://github.com/joey711/phyloseq/issues/990#issuecomment-424618425">#990</a>.</p>
<blockquote class="blockquote">
<p>One thing this code does is reassign the functions <code>class</code> and <code>order</code> to taxonomic ranks. This can cause issues if you need these functions.</p>
</blockquote>
<p>So you need to run something like this <code>rm(class, order, phylum, kingdom)</code> at the end of the code to remove these as variables. For now, I have not come up with a better solution.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ps_moth</span> <span class="op">&lt;-</span> <span class="va">ps_moth_nc</span></span>
<span><span class="va">tax.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">tax_table</span><span class="op">(</span><span class="va">ps_moth</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">{</span> <span class="va">tax.clean</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tax.clean</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="va">tax.clean</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tax.clean</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html">nrow</a></span><span class="op">(</span><span class="va">tax.clean</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tax.clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">kingdom</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"k_"</span>, <span class="va">tax.clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>        <span class="va">tax.clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">kingdom</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tax.clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p_"</span>, <span class="va">tax.clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>        <span class="va">tax.clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tax.clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">class</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"c_"</span>, <span class="va">tax.clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>        <span class="va">tax.clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">class</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tax.clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">order</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"o_"</span>, <span class="va">tax.clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">4</span><span class="op">]</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>        <span class="va">tax.clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">order</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tax.clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">tax.clean</span><span class="op">$</span><span class="va">Genus</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"f"</span>,<span class="va">tax.clean</span><span class="op">$</span><span class="va">Family</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">tax_table</span><span class="op">(</span><span class="va">ps_moth</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tax.clean</span><span class="op">)</span></span>
<span><span class="fu">rank_names</span><span class="op">(</span><span class="va">ps_moth</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">class</span>, <span class="va">order</span>, <span class="va">phylum</span>, <span class="va">kingdom</span>, <span class="va">i</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Still the same ranks. Thatâ€™s good. What about the new groups? Letâ€™s take a peak at some families.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu">get_taxa_unique</span><span class="op">(</span><span class="va">ps_moth</span>, <span class="st">"Family"</span><span class="op">)</span>, <span class="fl">16</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><div id="quarto-appendix" class="default"><section id="source-code" class="level4 appendix"><h2 class="anchored quarto-appendix-heading">Source Code</h2><div class="quarto-appendix-contents">
<p>The source code for this page can be accessed on GitHub <svg aria-hidden="true" role="img" viewbox="0 0 496 512" style="height:1em;width:0.97em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg> by <a href="https://github.com/istmobiome/trans-shrimp/blob/main/docs/ssu-workflows/compare/index.qmd">clicking this link</a>.</p>
</div></section><section id="data-availability" class="level4 appendix"><h2 class="anchored quarto-appendix-heading">Data Availability</h2><div class="quarto-appendix-contents">
<p>Raw fastq files available on figshare at <a href="https://doi.org/10.25573/data.14686665">10.25573/data.14686665</a>. Trimmed fastq files (primers removed) available through the ENA under project accession number <a href="https://www.ebi.ac.uk/ena/browser/view/PRJEB45074">PRJEB45074 (ERP129199)</a>. Data generated in this workflow can be accessed on figshare at <a href="https://doi.org/10.25573/data.14687184">10.25573/data.14687184</a>.</p>
</div></section><section id="last-updated-on" class="level4 appendix"><h2 class="anchored quarto-appendix-heading">Last updated on</h2><div class="quarto-appendix-contents">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-09-29 11:02:25 PDT"</code></pre>
</div>
</div>


<!-- -->

</div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/istmobiome\.github\.io\/trans-shrimp\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb26" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "3. OTU Workflow"</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> |</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">  Workflows for processing 16S rRNA shrimp and environmental sample data sets using paired end reads, beginning with raw fastq files, ending with sequence and taxonomy tables.</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>{{&lt; include ../_setup.qmd &gt;}}</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>{{&lt; include /include/_chunk_colors.qmd &gt;}}</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../otu/files/rdata/otu_part2.rdata"</span>)</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>gdata<span class="sc">::</span><span class="fu">keep</span>(me_otu, mia_me_otu, mia_me_otu_summ,</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">sure =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../asv/files/rdata/asv_part2.rdata"</span>)</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>gdata<span class="sc">::</span><span class="fu">keep</span>(me_otu, mia_me_otu, mia_me_otu_summ,</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>            me_asv, mia_me_asv, mia_me_asv_summ,</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">sure =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../med/files/rdata/med_part2.rdata"</span>)</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>gdata<span class="sc">::</span><span class="fu">keep</span>(me_otu, mia_me_otu, mia_me_otu_summ,</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>            me_asv, mia_me_asv, mia_me_asv_summ,</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>            me_med, mia_me_med, mia_me_med_summ,</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">sure =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"compare"</span>,<span class="st">"include"</span>, <span class="st">"tables"</span>), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a><span class="fu">save.image</span>(<span class="st">"compare/files/rdata/compare_load.rdata"</span>)</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a><span class="co"># change to eval: true</span></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"files/rdata/original_me_objects.rdata"</span>)</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a><span class="co">#load("files/rdata/compare_part1.rdata")</span></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Biostrings)</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Biostrings)</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a><span class="do">########### READ IN THE MAPPING FILE FROM mothur2oligo #########################</span></span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>id_map <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_delim</span>(<span class="st">"../pipelineFiles_med/BACTERIA_ONLY/intermediate2"</span>, </span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>                            <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, </span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a>                            <span class="at">col_names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a>id_map <span class="ot">&lt;-</span> id_map <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"MOTHUR_ID"</span> <span class="ot">=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">rename</span>(., <span class="st">"MED_ID"</span> <span class="ot">=</span> <span class="dv">2</span>)</span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a>id_map<span class="sc">$</span>MOTHUR_ID_RED <span class="ot">&lt;-</span> id_map<span class="sc">$</span>MOTHUR_ID</span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a>id_map <span class="ot">&lt;-</span> id_map <span class="sc">%&gt;%</span></span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="st">"MOTHUR_ID_RED"</span>,<span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">"_</span><span class="sc">\\</span><span class="st">d+$"</span>,<span class="st">""</span>, .)))</span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a>id_map<span class="sc">$</span>MOTHUR_UID <span class="ot">&lt;-</span> id_map<span class="sc">$</span>MOTHUR_ID</span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a>id_map <span class="ot">&lt;-</span> id_map <span class="sc">%&gt;%</span></span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="st">"MOTHUR_UID"</span>,<span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">".*_"</span>,<span class="st">""</span>, .)))</span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a><span class="do">########### READ IN THE OTU LIST FROM MOTHUR ###################################</span></span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a><span class="do">########### get.otulist(list=final.opti_mcc.list, sort=name) ###################</span></span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a>otu_list <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_delim</span>(<span class="st">"final.opti_mcc.0.03.otu"</span>, </span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a>                              <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a>otu_list <span class="ot">&lt;-</span> otu_list <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"MOTHUR_ID"</span> <span class="ot">=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a>                         dplyr<span class="sc">::</span><span class="fu">rename</span>(., <span class="st">"MOTHUR_OTU"</span> <span class="ot">=</span> <span class="dv">2</span>)</span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a><span class="do">########### FUNCTION TO READ IN FASTA FILES  ###################################</span></span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a>get_fasta_headers <span class="ot">&lt;-</span> <span class="cf">function</span>(file_path) {</span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read the FASTA file</span></span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a>    fasta <span class="ot">&lt;-</span> <span class="fu">readDNAStringSet</span>(file_path)</span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract and return the headers</span></span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a>    headers <span class="ot">&lt;-</span> <span class="fu">names</span>(fasta)</span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(headers)</span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a>fa_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"NODES/"</span>, <span class="at">pattern =</span> <span class="st">".fa"</span>, <span class="at">full.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a>seqmatch <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a>total_files <span class="ot">&lt;-</span> <span class="fu">length</span>(fa_files)</span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"ALL_RESULTS"</span>))  </span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_along</span>(fa_files)) {</span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a>  tmp_fasta_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"NODES/"</span>, fa_files[j])</span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a>  <span class="co">#tmp_fasta_file &lt;- paste0("NODES/", j)</span></span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Processing file %d of %d: %s</span><span class="sc">\n</span><span class="st">"</span>, j, total_files, tmp_fasta_file))</span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a>  tmp_input_ids <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">get_fasta_headers</span>(tmp_fasta_file))</span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a>  tmp_input_ids <span class="ot">&lt;-</span> tmp_input_ids <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"MED_ID"</span> <span class="ot">=</span> <span class="dv">1</span>)  </span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a>  tmp_input_ids <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>(tmp_input_ids)</span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a>  tmp_1 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_input_ids, id_map, <span class="at">by =</span> <span class="st">"MED_ID"</span>) </span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a>  tmp_2 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">as.data.frame</span>(tmp_1), </span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">as.data.frame</span>(otu_list), </span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a>                            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"MOTHUR_ID_RED"</span> <span class="ot">=</span> <span class="st">"MOTHUR_ID"</span> ), </span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a>                            <span class="at">keep =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a>  tmp_summ <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">table</span>(tmp_2<span class="sc">$</span>MOTHUR_OTU, <span class="at">useNA =</span> <span class="st">"always"</span>))</span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a>  tmp_summ<span class="sc">$</span>file_name <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(<span class="fu">basename</span>(tmp_fasta_file), <span class="st">".fa"</span>, <span class="st">""</span>)</span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a>  tmp_base_name <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(<span class="fu">basename</span>(tmp_fasta_file), <span class="st">".fa"</span>, <span class="st">""</span>)</span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_delim</span>(tmp_2, </span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a>              <span class="fu">paste</span>(<span class="st">"ALL_RESULTS/"</span>, tmp_base_name, <span class="st">".txt"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb26-120"><a href="#cb26-120" aria-hidden="true" tabindex="-1"></a>              <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb26-121"><a href="#cb26-121" aria-hidden="true" tabindex="-1"></a>  seqmatch <span class="ot">&lt;-</span> <span class="fu">rbind</span>(seqmatch, tmp_summ) </span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-125"><a href="#cb26-125" aria-hidden="true" tabindex="-1"></a>seqmatch <span class="ot">&lt;-</span> seqmatch <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"MOTHUR_OTU"</span> <span class="ot">=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-126"><a href="#cb26-126" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">rename</span>(., <span class="st">"COUNT"</span> <span class="ot">=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-127"><a href="#cb26-127" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">rename</span>(., <span class="st">"MED_NODE"</span> <span class="ot">=</span> <span class="dv">3</span>) </span>
<span id="cb26-128"><a href="#cb26-128" aria-hidden="true" tabindex="-1"></a>seqmatch<span class="sc">$</span>MOTHUR_OTU <span class="ot">&lt;-</span> <span class="fu">as.character</span>(seqmatch<span class="sc">$</span>MOTHUR_OTU)</span>
<span id="cb26-129"><a href="#cb26-129" aria-hidden="true" tabindex="-1"></a>seqmatch<span class="sc">$</span>MOTHUR_OTU[<span class="fu">is.na</span>(seqmatch<span class="sc">$</span>MOTHUR_OTU)] <span class="ot">&lt;-</span> <span class="st">"NO_OTU"</span></span>
<span id="cb26-130"><a href="#cb26-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-131"><a href="#cb26-131" aria-hidden="true" tabindex="-1"></a><span class="fu">write_delim</span>(seqmatch, <span class="st">"seqmatch.txt"</span>, <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb26-132"><a href="#cb26-132" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(seqmatch, <span class="st">"seqmatch.rds"</span>)</span>
<span id="cb26-133"><a href="#cb26-133" aria-hidden="true" tabindex="-1"></a><span class="co">#save.image("seqmatch_workflow.rdata")</span></span>
<span id="cb26-134"><a href="#cb26-134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-135"><a href="#cb26-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-138"><a href="#cb26-138" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-139"><a href="#cb26-139" aria-hidden="true" tabindex="-1"></a>seqmatch <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"files/rdata/seqmatch.rds"</span>)</span>
<span id="cb26-140"><a href="#cb26-140" aria-hidden="true" tabindex="-1"></a>seqmatch<span class="sc">$</span>MED_NODE <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"MED"</span>, seqmatch<span class="sc">$</span>MED_NODE, <span class="at">sep =</span><span class="st">""</span>)</span>
<span id="cb26-141"><a href="#cb26-141" aria-hidden="true" tabindex="-1"></a><span class="co">#seqmatch$UNIQUE_ID &lt;- paste0(seqmatch$MED_NODE, "-", seqmatch$MOTHUR_OTU)</span></span>
<span id="cb26-142"><a href="#cb26-142" aria-hidden="true" tabindex="-1"></a>seqmatch</span>
<span id="cb26-143"><a href="#cb26-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-144"><a href="#cb26-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-145"><a href="#cb26-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-148"><a href="#cb26-148" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-149"><a href="#cb26-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary packages</span></span>
<span id="cb26-150"><a href="#cb26-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-151"><a href="#cb26-151" aria-hidden="true" tabindex="-1"></a>calculate_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb26-152"><a href="#cb26-152" aria-hidden="true" tabindex="-1"></a>  max_val <span class="ot">&lt;-</span> <span class="fu">max</span>(data<span class="sc">$</span>COUNT)</span>
<span id="cb26-153"><a href="#cb26-153" aria-hidden="true" tabindex="-1"></a>  no_otu_val <span class="ot">&lt;-</span> data<span class="sc">$</span>COUNT[data<span class="sc">$</span>MOTHUR_OTU <span class="sc">==</span> <span class="st">"NO_OTU"</span>]</span>
<span id="cb26-154"><a href="#cb26-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-155"><a href="#cb26-155" aria-hidden="true" tabindex="-1"></a>  sum_non_max <span class="ot">&lt;-</span> <span class="fu">sum</span>(data<span class="sc">$</span>COUNT[data<span class="sc">$</span>COUNT <span class="sc">!=</span> max_val])</span>
<span id="cb26-156"><a href="#cb26-156" aria-hidden="true" tabindex="-1"></a>  adjusted_sum_non_max <span class="ot">&lt;-</span> sum_non_max <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">length</span>(no_otu_val) <span class="sc">&gt;</span> <span class="dv">0</span>, no_otu_val, <span class="dv">0</span>)</span>
<span id="cb26-157"><a href="#cb26-157" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-158"><a href="#cb26-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb26-159"><a href="#cb26-159" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_value =</span> max_val,</span>
<span id="cb26-160"><a href="#cb26-160" aria-hidden="true" tabindex="-1"></a>    <span class="at">combined_others =</span> <span class="fu">paste</span>(data<span class="sc">$</span>MOTHUR_OTU[<span class="fu">order</span>(<span class="sc">-</span>data<span class="sc">$</span>COUNT)], <span class="at">collapse =</span> <span class="st">", "</span>),</span>
<span id="cb26-161"><a href="#cb26-161" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_otu_value =</span> <span class="fu">ifelse</span>(<span class="fu">length</span>(no_otu_val) <span class="sc">&gt;</span> <span class="dv">0</span>, no_otu_val, <span class="cn">NA</span>),</span>
<span id="cb26-162"><a href="#cb26-162" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_non_max_values =</span> sum_non_max,</span>
<span id="cb26-163"><a href="#cb26-163" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjusted_sum_non_max =</span> adjusted_sum_non_max</span>
<span id="cb26-164"><a href="#cb26-164" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-165"><a href="#cb26-165" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-166"><a href="#cb26-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-167"><a href="#cb26-167" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to each group and combine results</span></span>
<span id="cb26-168"><a href="#cb26-168" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> seqmatch <span class="sc">%&gt;%</span></span>
<span id="cb26-169"><a href="#cb26-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(MED_NODE) <span class="sc">%&gt;%</span></span>
<span id="cb26-170"><a href="#cb26-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do</span>(<span class="fu">calculate_summary</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb26-171"><a href="#cb26-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb26-172"><a href="#cb26-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-173"><a href="#cb26-173" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span>
<span id="cb26-174"><a href="#cb26-174" aria-hidden="true" tabindex="-1"></a>seqmatch</span>
<span id="cb26-175"><a href="#cb26-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-176"><a href="#cb26-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-179"><a href="#cb26-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-180"><a href="#cb26-180" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-181"><a href="#cb26-181" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-182"><a href="#cb26-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-183"><a href="#cb26-183" aria-hidden="true" tabindex="-1"></a><span class="co"># Library</span></span>
<span id="cb26-184"><a href="#cb26-184" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(networkD3)</span>
<span id="cb26-185"><a href="#cb26-185" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb26-186"><a href="#cb26-186" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb26-187"><a href="#cb26-187" aria-hidden="true" tabindex="-1"></a>tmp_links <span class="ot">&lt;-</span> seqmatch <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"source"</span> <span class="ot">=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-188"><a href="#cb26-188" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(., <span class="st">"value"</span> <span class="ot">=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-189"><a href="#cb26-189" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(., <span class="st">"target"</span> <span class="ot">=</span> <span class="dv">3</span>)</span>
<span id="cb26-190"><a href="#cb26-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-191"><a href="#cb26-191" aria-hidden="true" tabindex="-1"></a>tmp_links <span class="ot">&lt;-</span> <span class="fu">filter</span>(tmp_links, source <span class="sc">!=</span> <span class="st">"NO_OTU"</span>)</span>
<span id="cb26-192"><a href="#cb26-192" aria-hidden="true" tabindex="-1"></a>tmp_links <span class="ot">&lt;-</span> tmp_links <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(target) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">1000</span>)</span>
<span id="cb26-193"><a href="#cb26-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-194"><a href="#cb26-194" aria-hidden="true" tabindex="-1"></a>tmp_nodes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb26-195"><a href="#cb26-195" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="fu">as.character</span>(tmp_links<span class="sc">$</span>source), </span>
<span id="cb26-196"><a href="#cb26-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>(tmp_links<span class="sc">$</span>target)) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb26-197"><a href="#cb26-197" aria-hidden="true" tabindex="-1"></a>)  </span>
<span id="cb26-198"><a href="#cb26-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-199"><a href="#cb26-199" aria-hidden="true" tabindex="-1"></a>tmp_links<span class="sc">$</span>IDsource <span class="ot">&lt;-</span> <span class="fu">match</span>(tmp_links<span class="sc">$</span>source, tmp_nodes<span class="sc">$</span>name)<span class="sc">-</span><span class="dv">1</span> </span>
<span id="cb26-200"><a href="#cb26-200" aria-hidden="true" tabindex="-1"></a>tmp_links<span class="sc">$</span>IDtarget <span class="ot">&lt;-</span> <span class="fu">match</span>(tmp_links<span class="sc">$</span>target, tmp_nodes<span class="sc">$</span>name)<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb26-201"><a href="#cb26-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-202"><a href="#cb26-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-203"><a href="#cb26-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-204"><a href="#cb26-204" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">sankeyNetwork</span>(<span class="at">Links =</span> tmp_links, <span class="at">Nodes =</span> tmp_nodes,</span>
<span id="cb26-205"><a href="#cb26-205" aria-hidden="true" tabindex="-1"></a>              <span class="at">Source =</span> <span class="st">"IDsource"</span>, <span class="at">Target =</span> <span class="st">"IDtarget"</span>,</span>
<span id="cb26-206"><a href="#cb26-206" aria-hidden="true" tabindex="-1"></a>              <span class="at">Value =</span> <span class="st">"value"</span>, <span class="at">NodeID =</span> <span class="st">"name"</span>, </span>
<span id="cb26-207"><a href="#cb26-207" aria-hidden="true" tabindex="-1"></a>              <span class="at">sinksRight =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-208"><a href="#cb26-208" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb26-209"><a href="#cb26-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-210"><a href="#cb26-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-211"><a href="#cb26-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-212"><a href="#cb26-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-213"><a href="#cb26-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-214"><a href="#cb26-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-215"><a href="#cb26-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-216"><a href="#cb26-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-217"><a href="#cb26-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-218"><a href="#cb26-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-219"><a href="#cb26-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-220"><a href="#cb26-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-221"><a href="#cb26-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-222"><a href="#cb26-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-223"><a href="#cb26-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-224"><a href="#cb26-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-225"><a href="#cb26-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-226"><a href="#cb26-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-229"><a href="#cb26-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-230"><a href="#cb26-230" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-231"><a href="#cb26-231" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-232"><a href="#cb26-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-233"><a href="#cb26-233" aria-hidden="true" tabindex="-1"></a>me_otu_pb<span class="sc">$</span>tax_table <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row.names</span>(me_otu_pb<span class="sc">$</span>tax_table) <span class="sc">%in%</span> <span class="st">"Otu000003"</span>)</span>
<span id="cb26-234"><a href="#cb26-234" aria-hidden="true" tabindex="-1"></a>me_otu_pb<span class="sc">$</span>tax_table <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row.names</span>(me_otu_pb<span class="sc">$</span>tax_table) <span class="sc">%in%</span> <span class="st">"Otu010978"</span>)</span>
<span id="cb26-235"><a href="#cb26-235" aria-hidden="true" tabindex="-1"></a>me_otu_pb<span class="sc">$</span>tax_table <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row.names</span>(me_otu_pb<span class="sc">$</span>tax_table) <span class="sc">%in%</span> <span class="st">"Otu012751"</span>)</span>
<span id="cb26-236"><a href="#cb26-236" aria-hidden="true" tabindex="-1"></a>me_otu_pb<span class="sc">$</span>tax_table <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row.names</span>(me_otu_pb<span class="sc">$</span>tax_table) <span class="sc">%in%</span> <span class="st">"Otu027363"</span>)</span>
<span id="cb26-237"><a href="#cb26-237" aria-hidden="true" tabindex="-1"></a>me_otu_pb<span class="sc">$</span>tax_table <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row.names</span>(me_otu_pb<span class="sc">$</span>tax_table) <span class="sc">%in%</span> <span class="st">"Otu027988"</span>)</span>
<span id="cb26-238"><a href="#cb26-238" aria-hidden="true" tabindex="-1"></a>me_otu_pb<span class="sc">$</span>tax_table <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row.names</span>(me_otu_pb<span class="sc">$</span>tax_table) <span class="sc">%in%</span> <span class="st">"Otu115555"</span>)</span>
<span id="cb26-239"><a href="#cb26-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-240"><a href="#cb26-240" aria-hidden="true" tabindex="-1"></a>otu_list <span class="sc">%&gt;%</span> <span class="fu">filter</span>(otu_list<span class="sc">$</span>MOTHUR_ID <span class="sc">%in%</span> <span class="st">"M06508_12_000000000-CJG44_1_2111_7865_12074"</span>)</span>
<span id="cb26-241"><a href="#cb26-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-242"><a href="#cb26-242" aria-hidden="true" tabindex="-1"></a>otu_list <span class="sc">%&gt;%</span> <span class="fu">filter</span>(otu_list) <span class="sc">%in%</span> <span class="st">"M06508_12_000000000-CJG44_1_2111_7865_12074"</span></span>
<span id="cb26-243"><a href="#cb26-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-244"><a href="#cb26-244" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(input_ids<span class="sc">$</span>MED_ID, <span class="st">"M06508:12:000000000-CJG44:1:2111:7865:12074:1"</span>, <span class="at">negate =</span> <span class="cn">FALSE</span>) <span class="sc">==</span> <span class="cn">TRUE</span></span>
<span id="cb26-245"><a href="#cb26-245" aria-hidden="true" tabindex="-1"></a>input_ids <span class="sc">%&gt;%</span> </span>
<span id="cb26-246"><a href="#cb26-246" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="fu">if_any</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">str_detect</span>(.x, <span class="st">'"M06508:12:000000000-CJG44:1:2111:7865:12074:1'</span>)))</span>
<span id="cb26-247"><a href="#cb26-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-248"><a href="#cb26-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-251"><a href="#cb26-251" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-252"><a href="#cb26-252" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-253"><a href="#cb26-253" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-254"><a href="#cb26-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-255"><a href="#cb26-255" aria-hidden="true" tabindex="-1"></a>me_asv_tmp <span class="ot">&lt;-</span> <span class="fu">clone</span>(me_asv)</span>
<span id="cb26-256"><a href="#cb26-256" aria-hidden="true" tabindex="-1"></a>me_otu_tmp <span class="ot">&lt;-</span> <span class="fu">clone</span>(me_otu)</span>
<span id="cb26-257"><a href="#cb26-257" aria-hidden="true" tabindex="-1"></a>me_med_tmp <span class="ot">&lt;-</span> <span class="fu">clone</span>(me_med)</span>
<span id="cb26-258"><a href="#cb26-258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-259"><a href="#cb26-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-260"><a href="#cb26-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-263"><a href="#cb26-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-264"><a href="#cb26-264" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb26-265"><a href="#cb26-265" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-266"><a href="#cb26-266" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb26-267"><a href="#cb26-267" aria-hidden="true" tabindex="-1"></a>me_ds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"me_asv_tmp"</span>, <span class="st">"me_otu_tmp"</span>, <span class="st">"me_med_tmp"</span>)</span>
<span id="cb26-268"><a href="#cb26-268" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> me_ds) {</span>
<span id="cb26-269"><a href="#cb26-269" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(j)</span>
<span id="cb26-270"><a href="#cb26-270" aria-hidden="true" tabindex="-1"></a>  tmp_tax <span class="ot">&lt;-</span> tmp_get<span class="sc">$</span>tax_table</span>
<span id="cb26-271"><a href="#cb26-271" aria-hidden="true" tabindex="-1"></a>  tmp_samp <span class="ot">&lt;-</span> tmp_get<span class="sc">$</span>sample_table</span>
<span id="cb26-272"><a href="#cb26-272" aria-hidden="true" tabindex="-1"></a>  tmp_st <span class="ot">&lt;-</span> tmp_get<span class="sc">$</span>otu_table</span>
<span id="cb26-273"><a href="#cb26-273" aria-hidden="true" tabindex="-1"></a>  tmp_fasta <span class="ot">&lt;-</span> tmp_get<span class="sc">$</span>rep_fasta</span>
<span id="cb26-274"><a href="#cb26-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-275"><a href="#cb26-275" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(tmp_tax)){</span>
<span id="cb26-276"><a href="#cb26-276" aria-hidden="true" tabindex="-1"></a>       <span class="cf">if</span> (tmp_tax[i,<span class="dv">2</span>] <span class="sc">==</span> <span class="st">"p__Proteobacteria"</span> <span class="sc">&amp;</span> tmp_tax[i,<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"c__Alphaproteobacteria"</span>){</span>
<span id="cb26-277"><a href="#cb26-277" aria-hidden="true" tabindex="-1"></a>           phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"p__Alphaproteobacteria"</span>)</span>
<span id="cb26-278"><a href="#cb26-278" aria-hidden="true" tabindex="-1"></a>           tmp_tax[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb26-279"><a href="#cb26-279" aria-hidden="true" tabindex="-1"></a>   }   <span class="cf">else</span> <span class="cf">if</span> (tmp_tax[i,<span class="dv">2</span>] <span class="sc">==</span> <span class="st">"p__Proteobacteria"</span> <span class="sc">&amp;</span> tmp_tax[i,<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"c__Gammaproteobacteria"</span>){</span>
<span id="cb26-280"><a href="#cb26-280" aria-hidden="true" tabindex="-1"></a>           phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"p__Gammaproteobacteria"</span>)</span>
<span id="cb26-281"><a href="#cb26-281" aria-hidden="true" tabindex="-1"></a>           tmp_tax[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb26-282"><a href="#cb26-282" aria-hidden="true" tabindex="-1"></a>   }   <span class="cf">else</span> <span class="cf">if</span> (tmp_tax[i,<span class="dv">2</span>] <span class="sc">==</span> <span class="st">"p__Proteobacteria"</span> <span class="sc">&amp;</span> tmp_tax[i,<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"c__Epsilonproteobacteria"</span>){</span>
<span id="cb26-283"><a href="#cb26-283" aria-hidden="true" tabindex="-1"></a>           phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"p__Epsilonproteobacteria"</span>)</span>
<span id="cb26-284"><a href="#cb26-284" aria-hidden="true" tabindex="-1"></a>           tmp_tax[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb26-285"><a href="#cb26-285" aria-hidden="true" tabindex="-1"></a>   }   <span class="cf">else</span> <span class="cf">if</span> (tmp_tax[i,<span class="dv">2</span>] <span class="sc">==</span> <span class="st">"p__Proteobacteria"</span> <span class="sc">&amp;</span> tmp_tax[i,<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"c__Zetaproteobacteria"</span>){</span>
<span id="cb26-286"><a href="#cb26-286" aria-hidden="true" tabindex="-1"></a>              phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"p__Zetaproteobacteria"</span>)</span>
<span id="cb26-287"><a href="#cb26-287" aria-hidden="true" tabindex="-1"></a>           tmp_tax[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb26-288"><a href="#cb26-288" aria-hidden="true" tabindex="-1"></a>   }   <span class="cf">else</span> <span class="cf">if</span> (tmp_tax[i,<span class="dv">2</span>] <span class="sc">==</span> <span class="st">"p__Proteobacteria"</span> <span class="sc">&amp;</span> tmp_tax[i,<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"c__"</span>){</span>
<span id="cb26-289"><a href="#cb26-289" aria-hidden="true" tabindex="-1"></a>           phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"p__Proteobacteria"</span>)</span>
<span id="cb26-290"><a href="#cb26-290" aria-hidden="true" tabindex="-1"></a>           tmp_tax[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb26-291"><a href="#cb26-291" aria-hidden="true" tabindex="-1"></a>       }</span>
<span id="cb26-292"><a href="#cb26-292" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb26-293"><a href="#cb26-293" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(j, <span class="st">"_tmp"</span>, <span class="st">"_pb"</span>)</span>
<span id="cb26-294"><a href="#cb26-294" aria-hidden="true" tabindex="-1"></a>  tmp_me <span class="ot">&lt;-</span> microtable<span class="sc">$</span><span class="fu">new</span>(<span class="at">sample_table =</span> tmp_samp, </span>
<span id="cb26-295"><a href="#cb26-295" aria-hidden="true" tabindex="-1"></a>                         <span class="at">otu_table =</span> tmp_st, </span>
<span id="cb26-296"><a href="#cb26-296" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tax_table =</span> tmp_tax)</span>
<span id="cb26-297"><a href="#cb26-297" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb26-298"><a href="#cb26-298" aria-hidden="true" tabindex="-1"></a>  tmp_me<span class="sc">$</span>rep_fasta <span class="ot">&lt;-</span> tmp_fasta</span>
<span id="cb26-299"><a href="#cb26-299" aria-hidden="true" tabindex="-1"></a>  tmp_me<span class="sc">$</span><span class="fu">tidy_dataset</span>()</span>
<span id="cb26-300"><a href="#cb26-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_me)</span>
<span id="cb26-301"><a href="#cb26-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb26-302"><a href="#cb26-302" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-303"><a href="#cb26-303" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(class, order, phylum)</span>
<span id="cb26-304"><a href="#cb26-304" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_tmp"</span>))</span>
<span id="cb26-305"><a href="#cb26-305" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span>
<span id="cb26-306"><a href="#cb26-306" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(i,j)</span>
<span id="cb26-307"><a href="#cb26-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-308"><a href="#cb26-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-309"><a href="#cb26-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-312"><a href="#cb26-312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-313"><a href="#cb26-313" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb26-314"><a href="#cb26-314" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-315"><a href="#cb26-315" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb26-316"><a href="#cb26-316" aria-hidden="true" tabindex="-1"></a>me_ds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"me_asv"</span>, <span class="st">"me_otu"</span>, <span class="st">"me_med"</span>, </span>
<span id="cb26-317"><a href="#cb26-317" aria-hidden="true" tabindex="-1"></a>           <span class="st">"me_asv_pb"</span>, <span class="st">"me_otu_pb"</span>, <span class="st">"me_med_pb"</span>)</span>
<span id="cb26-318"><a href="#cb26-318" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> me_ds) {</span>
<span id="cb26-319"><a href="#cb26-319" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(j)</span>
<span id="cb26-320"><a href="#cb26-320" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(j, <span class="st">"_asv"</span>) <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb26-321"><a href="#cb26-321" aria-hidden="true" tabindex="-1"></a>    tmp_get<span class="sc">$</span><span class="fu">add_rownames2taxonomy</span>(<span class="at">use_name =</span> <span class="st">"ASV"</span>)</span>
<span id="cb26-322"><a href="#cb26-322" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-323"><a href="#cb26-323" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">str_detect</span>(j, <span class="st">"_otu"</span>) <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb26-324"><a href="#cb26-324" aria-hidden="true" tabindex="-1"></a>    tmp_get<span class="sc">$</span><span class="fu">add_rownames2taxonomy</span>(<span class="at">use_name =</span> <span class="st">"OTU"</span>)</span>
<span id="cb26-325"><a href="#cb26-325" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-326"><a href="#cb26-326" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> (<span class="fu">str_detect</span>(j, <span class="st">"_med"</span>) <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb26-327"><a href="#cb26-327" aria-hidden="true" tabindex="-1"></a>    tmp_get<span class="sc">$</span><span class="fu">add_rownames2taxonomy</span>(<span class="at">use_name =</span> <span class="st">"MED"</span>)</span>
<span id="cb26-328"><a href="#cb26-328" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-329"><a href="#cb26-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb26-330"><a href="#cb26-330" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-331"><a href="#cb26-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-332"><a href="#cb26-332" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-333"><a href="#cb26-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-336"><a href="#cb26-336" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-337"><a href="#cb26-337" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> me_ds) {</span>
<span id="cb26-338"><a href="#cb26-338" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(j)</span>
<span id="cb26-339"><a href="#cb26-339" aria-hidden="true" tabindex="-1"></a>  tmp_get<span class="sc">$</span>auto_tidy <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb26-340"><a href="#cb26-340" aria-hidden="true" tabindex="-1"></a>  tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"files/rdata/"</span>)</span>
<span id="cb26-341"><a href="#cb26-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(tmp_get, <span class="fu">paste</span>(tmp_path, j, <span class="st">".rds"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb26-342"><a href="#cb26-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb26-343"><a href="#cb26-343" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-344"><a href="#cb26-344" aria-hidden="true" tabindex="-1"></a>me_asv_pb<span class="sc">$</span>tax_table</span>
<span id="cb26-345"><a href="#cb26-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-346"><a href="#cb26-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-347"><a href="#cb26-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-350"><a href="#cb26-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-351"><a href="#cb26-351" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-352"><a href="#cb26-352" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-353"><a href="#cb26-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-354"><a href="#cb26-354" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span>
<span id="cb26-355"><a href="#cb26-355" aria-hidden="true" tabindex="-1"></a>me_med_pb</span>
<span id="cb26-356"><a href="#cb26-356" aria-hidden="true" tabindex="-1"></a><span class="co"># remember first clone the whole dataset</span></span>
<span id="cb26-357"><a href="#cb26-357" aria-hidden="true" tabindex="-1"></a><span class="co"># see https://chiliubio.github.io/microeco_tutorial/notes.html#clone-function</span></span>
<span id="cb26-358"><a href="#cb26-358" aria-hidden="true" tabindex="-1"></a>me_med_pb_shrimp <span class="ot">&lt;-</span> <span class="fu">clone</span>(me_med_pb)</span>
<span id="cb26-359"><a href="#cb26-359" aria-hidden="true" tabindex="-1"></a><span class="co"># select 'CW'</span></span>
<span id="cb26-360"><a href="#cb26-360" aria-hidden="true" tabindex="-1"></a>me_med_pb_shrimp<span class="sc">$</span>sample_table <span class="ot">&lt;-</span> <span class="fu">subset</span>(me_med_pb_shrimp<span class="sc">$</span>sample_table, TAXON <span class="sc">==</span> <span class="st">"Snapping_shrimp"</span>)</span>
<span id="cb26-361"><a href="#cb26-361" aria-hidden="true" tabindex="-1"></a><span class="co"># or: group_CW$sample_table &lt;- subset(group_CW$sample_table, grepl("CW", Group))</span></span>
<span id="cb26-362"><a href="#cb26-362" aria-hidden="true" tabindex="-1"></a><span class="co"># use tidy_dataset to trim all the basic files</span></span>
<span id="cb26-363"><a href="#cb26-363" aria-hidden="true" tabindex="-1"></a>me_med_pb_shrimp<span class="sc">$</span><span class="fu">tidy_dataset</span>()</span>
<span id="cb26-364"><a href="#cb26-364" aria-hidden="true" tabindex="-1"></a>me_med_pb_shrimp</span>
<span id="cb26-365"><a href="#cb26-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-366"><a href="#cb26-366" aria-hidden="true" tabindex="-1"></a><span class="co"># create trans_abund object</span></span>
<span id="cb26-367"><a href="#cb26-367" aria-hidden="true" tabindex="-1"></a><span class="co"># select top 8 abundant Phyla.</span></span>
<span id="cb26-368"><a href="#cb26-368" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> trans_abund<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> me_med_pb_shrimp, <span class="at">taxrank =</span> <span class="st">"Phylum"</span>, <span class="at">ntaxa =</span> <span class="dv">8</span>)</span>
<span id="cb26-369"><a href="#cb26-369" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">plot_bar</span>(<span class="at">others_color =</span> <span class="st">"grey70"</span>, <span class="at">facet =</span> <span class="st">"TISSUE"</span>, <span class="at">xtext_keep =</span> <span class="cn">FALSE</span>, <span class="at">legend_text_italic =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-370"><a href="#cb26-370" aria-hidden="true" tabindex="-1"></a><span class="co"># return a ggplot2 object</span></span>
<span id="cb26-371"><a href="#cb26-371" aria-hidden="true" tabindex="-1"></a><span class="co"># require package ggh4x, first run install.packages("ggh4x") if not installed</span></span>
<span id="cb26-372"><a href="#cb26-372" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">plot_bar</span>(<span class="at">others_color =</span> <span class="st">"grey70"</span>, <span class="at">facet =</span> <span class="fu">c</span>(<span class="st">"TISSUE"</span>, <span class="st">"OCEAN"</span>), <span class="at">xtext_keep =</span> <span class="cn">FALSE</span>, <span class="at">legend_text_italic =</span> <span class="cn">FALSE</span>, <span class="at">barwidth =</span> <span class="dv">1</span>)</span>
<span id="cb26-373"><a href="#cb26-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-374"><a href="#cb26-374" aria-hidden="true" tabindex="-1"></a><span class="co"># The groupmean parameter can be used to obtain the group-mean barplot.</span></span>
<span id="cb26-375"><a href="#cb26-375" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> trans_abund<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> me_med_pb_shrimp, <span class="at">taxrank =</span> <span class="st">"Phylum"</span>, <span class="at">ntaxa =</span> <span class="dv">10</span>, <span class="at">groupmean =</span> <span class="st">"TISSUE"</span>)</span>
<span id="cb26-376"><a href="#cb26-376" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> t1<span class="sc">$</span><span class="fu">plot_bar</span>(<span class="at">others_color =</span> <span class="st">"grey70"</span>, <span class="at">legend_text_italic =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-377"><a href="#cb26-377" aria-hidden="true" tabindex="-1"></a>g1 <span class="sc">+</span> <span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>))</span>
<span id="cb26-378"><a href="#cb26-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-379"><a href="#cb26-379" aria-hidden="true" tabindex="-1"></a><span class="co"># show 40 taxa at Genus level</span></span>
<span id="cb26-380"><a href="#cb26-380" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> trans_abund<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> me_med_pb_shrimp, <span class="at">taxrank =</span> <span class="st">"MED"</span>, <span class="at">ntaxa =</span> <span class="dv">40</span>)</span>
<span id="cb26-381"><a href="#cb26-381" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> t1<span class="sc">$</span><span class="fu">plot_heatmap</span>(<span class="at">facet =</span> <span class="st">"TISSUE"</span>, <span class="at">xtext_keep =</span> <span class="cn">FALSE</span>, <span class="at">withmargin =</span> <span class="cn">FALSE</span>, <span class="at">plot_breaks =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>), <span class="at">pheatmap =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-382"><a href="#cb26-382" aria-hidden="true" tabindex="-1"></a>g1</span>
<span id="cb26-383"><a href="#cb26-383" aria-hidden="true" tabindex="-1"></a>g1 <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">'italic'</span>))</span>
<span id="cb26-384"><a href="#cb26-384" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> t1<span class="sc">$</span><span class="fu">plot_heatmap</span>(<span class="at">clustering_plot =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-385"><a href="#cb26-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-386"><a href="#cb26-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-387"><a href="#cb26-387" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> trans_abund<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> me_med_pb_shrimp, <span class="at">taxrank =</span> <span class="st">"Phylum"</span>, <span class="at">ntaxa =</span> <span class="dv">10</span>, <span class="at">groupmean =</span> <span class="st">"TISSUE"</span>)</span>
<span id="cb26-388"><a href="#cb26-388" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> t1<span class="sc">$</span><span class="fu">plot_bar</span>(<span class="at">coord_flip =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-389"><a href="#cb26-389" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> g1 <span class="sc">+</span> <span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>), <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.line.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb26-390"><a href="#cb26-390" aria-hidden="true" tabindex="-1"></a>g1</span>
<span id="cb26-391"><a href="#cb26-391" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> t1<span class="sc">$</span><span class="fu">plot_bar</span>(<span class="at">clustering_plot =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-392"><a href="#cb26-392" aria-hidden="true" tabindex="-1"></a><span class="co"># In this case, g1 (aplot object) is the combination of different ggplot objects</span></span>
<span id="cb26-393"><a href="#cb26-393" aria-hidden="true" tabindex="-1"></a><span class="co"># to adjust the main plot, please select g1[[1]]</span></span>
<span id="cb26-394"><a href="#cb26-394" aria-hidden="true" tabindex="-1"></a>g1[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> g1[[<span class="dv">1</span>]] <span class="sc">+</span> <span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>), <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.line.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb26-395"><a href="#cb26-395" aria-hidden="true" tabindex="-1"></a>g1</span>
<span id="cb26-396"><a href="#cb26-396" aria-hidden="true" tabindex="-1"></a><span class="co"># save the figure</span></span>
<span id="cb26-397"><a href="#cb26-397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-398"><a href="#cb26-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-399"><a href="#cb26-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-400"><a href="#cb26-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-401"><a href="#cb26-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-402"><a href="#cb26-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-403"><a href="#cb26-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-404"><a href="#cb26-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-405"><a href="#cb26-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-406"><a href="#cb26-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-407"><a href="#cb26-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-408"><a href="#cb26-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-409"><a href="#cb26-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-410"><a href="#cb26-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-411"><a href="#cb26-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-412"><a href="#cb26-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-413"><a href="#cb26-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-414"><a href="#cb26-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-415"><a href="#cb26-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-416"><a href="#cb26-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-417"><a href="#cb26-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-418"><a href="#cb26-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-419"><a href="#cb26-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-422"><a href="#cb26-422" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-423"><a href="#cb26-423" aria-hidden="true" tabindex="-1"></a>me_ds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"me_asv"</span>, <span class="st">"me_otu"</span>, <span class="st">"me_med"</span>)</span>
<span id="cb26-424"><a href="#cb26-424" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> me_ds) {</span>
<span id="cb26-425"><a href="#cb26-425" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(j)</span>
<span id="cb26-426"><a href="#cb26-426" aria-hidden="true" tabindex="-1"></a>  tmp_ds <span class="ot">&lt;-</span> microeco<span class="sc">::</span><span class="fu">clone</span>(tmp_get)</span>
<span id="cb26-427"><a href="#cb26-427" aria-hidden="true" tabindex="-1"></a>  tmp_ds_df <span class="ot">&lt;-</span> tmp_ds<span class="sc">$</span>otu_table</span>
<span id="cb26-428"><a href="#cb26-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-429"><a href="#cb26-429" aria-hidden="true" tabindex="-1"></a>  tmp_type <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(<span class="fu">rownames</span>(tmp_ds_df)[<span class="dv">1</span>], <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>, <span class="st">""</span>)</span>
<span id="cb26-430"><a href="#cb26-430" aria-hidden="true" tabindex="-1"></a>  tmp_type <span class="ot">&lt;-</span> <span class="fu">paste</span>(tmp_type, <span class="st">"_ID"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb26-431"><a href="#cb26-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-432"><a href="#cb26-432" aria-hidden="true" tabindex="-1"></a>  tmp_ds_df <span class="ot">&lt;-</span> tmp_ds_df <span class="sc">%&gt;%</span> </span>
<span id="cb26-433"><a href="#cb26-433" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">total_reads =</span> <span class="fu">rowSums</span>(.), </span>
<span id="cb26-434"><a href="#cb26-434" aria-hidden="true" tabindex="-1"></a>           <span class="at">.before =</span> <span class="dv">1</span>)</span>
<span id="cb26-435"><a href="#cb26-435" aria-hidden="true" tabindex="-1"></a>  tmp_ds_df <span class="ot">&lt;-</span> tmp_ds_df  <span class="sc">%&gt;%</span> </span>
<span id="cb26-436"><a href="#cb26-436" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">total_reads_ES =</span> <span class="fu">rowSums</span>(<span class="fu">select</span>(., <span class="fu">contains</span>(<span class="st">"E_SAMP"</span>))), </span>
<span id="cb26-437"><a href="#cb26-437" aria-hidden="true" tabindex="-1"></a>           <span class="at">.after =</span> <span class="st">"total_reads"</span>)</span>
<span id="cb26-438"><a href="#cb26-438" aria-hidden="true" tabindex="-1"></a>  tmp_ds_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(tmp_ds_df, <span class="sc">-</span><span class="fu">contains</span>(<span class="st">"E_SAMP"</span>))</span>
<span id="cb26-439"><a href="#cb26-439" aria-hidden="true" tabindex="-1"></a>  tmp_ds_df <span class="ot">&lt;-</span> tmp_ds_df <span class="sc">%&gt;%</span> </span>
<span id="cb26-440"><a href="#cb26-440" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">total_reads_SS =</span> <span class="fu">rowSums</span>(.[<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(tmp_ds_df)]), </span>
<span id="cb26-441"><a href="#cb26-441" aria-hidden="true" tabindex="-1"></a>                  <span class="at">.after =</span> <span class="st">"total_reads_ES"</span>)</span>
<span id="cb26-442"><a href="#cb26-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-443"><a href="#cb26-443" aria-hidden="true" tabindex="-1"></a>  tmp_ds_df <span class="ot">&lt;-</span> tmp_ds_df <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(tmp_type)</span>
<span id="cb26-444"><a href="#cb26-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-445"><a href="#cb26-445" aria-hidden="true" tabindex="-1"></a>  tmp_ds_df[, <span class="dv">5</span><span class="sc">:</span><span class="fu">ncol</span>(tmp_ds_df)] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="cn">NULL</span>)</span>
<span id="cb26-446"><a href="#cb26-446" aria-hidden="true" tabindex="-1"></a>  tmp_ds_df <span class="ot">&lt;-</span> tmp_ds_df <span class="sc">%&gt;%</span> </span>
<span id="cb26-447"><a href="#cb26-447" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">perc_reads_in_ES =</span> <span class="dv">100</span><span class="sc">*</span>(</span>
<span id="cb26-448"><a href="#cb26-448" aria-hidden="true" tabindex="-1"></a>    total_reads_ES <span class="sc">/</span> (total_reads_ES <span class="sc">+</span> total_reads_SS)),</span>
<span id="cb26-449"><a href="#cb26-449" aria-hidden="true" tabindex="-1"></a>                <span class="at">.after =</span> <span class="st">"total_reads_SS"</span>)</span>
<span id="cb26-450"><a href="#cb26-450" aria-hidden="true" tabindex="-1"></a>  tmp_ds_df<span class="sc">$</span>perc_reads_in_ES <span class="ot">&lt;-</span> <span class="fu">round</span>(tmp_ds_df<span class="sc">$</span>perc_reads_in_ES, <span class="at">digits =</span> <span class="dv">6</span>)</span>
<span id="cb26-451"><a href="#cb26-451" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_df"</span>))</span>
<span id="cb26-452"><a href="#cb26-452" aria-hidden="true" tabindex="-1"></a>  <span class="co">#tmp_name &lt;- str_replace(j, "_tmp", "_df")</span></span>
<span id="cb26-453"><a href="#cb26-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_ds_df)</span>
<span id="cb26-454"><a href="#cb26-454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb26-455"><a href="#cb26-455" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-456"><a href="#cb26-456" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_df"</span>)</span>
<span id="cb26-457"><a href="#cb26-457" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-458"><a href="#cb26-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-459"><a href="#cb26-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-462"><a href="#cb26-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-463"><a href="#cb26-463" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb26-464"><a href="#cb26-464" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-465"><a href="#cb26-465" aria-hidden="true" tabindex="-1"></a>me_ds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"me_asv"</span>, <span class="st">"me_otu"</span>, <span class="st">"me_med"</span>)</span>
<span id="cb26-466"><a href="#cb26-466" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> me_ds) {</span>
<span id="cb26-467"><a href="#cb26-467" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(j)</span>
<span id="cb26-468"><a href="#cb26-468" aria-hidden="true" tabindex="-1"></a>  tmp_1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">rowSums</span>(tmp_get<span class="sc">$</span>otu_table <span class="sc">!=</span> <span class="dv">0</span>))</span>
<span id="cb26-469"><a href="#cb26-469" aria-hidden="true" tabindex="-1"></a>  tmp_type <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(<span class="fu">rownames</span>(tmp_1)[<span class="dv">1</span>], <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>, <span class="st">""</span>)</span>
<span id="cb26-470"><a href="#cb26-470" aria-hidden="true" tabindex="-1"></a>  tmp_type <span class="ot">&lt;-</span> <span class="fu">paste</span>(tmp_type, <span class="st">"_ID"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb26-471"><a href="#cb26-471" aria-hidden="true" tabindex="-1"></a>  tmp_1 <span class="ot">&lt;-</span> tmp_1 <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(tmp_type)</span>
<span id="cb26-472"><a href="#cb26-472" aria-hidden="true" tabindex="-1"></a>  tmp_1 <span class="ot">&lt;-</span> tmp_1 <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"total_samples"</span> <span class="ot">=</span> <span class="dv">2</span>)  </span>
<span id="cb26-473"><a href="#cb26-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-474"><a href="#cb26-474" aria-hidden="true" tabindex="-1"></a>  tmp_2 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(tmp_get<span class="sc">$</span>otu_table, <span class="fu">contains</span>(<span class="st">"E_SAMP"</span>))</span>
<span id="cb26-475"><a href="#cb26-475" aria-hidden="true" tabindex="-1"></a>  tmp_2<span class="sc">$</span>num_samp_ES <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(tmp_2 <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb26-476"><a href="#cb26-476" aria-hidden="true" tabindex="-1"></a>  tmp_2 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(tmp_2, <span class="fu">contains</span>(<span class="st">"num_samp_ES"</span>))</span>
<span id="cb26-477"><a href="#cb26-477" aria-hidden="true" tabindex="-1"></a>  tmp_2 <span class="ot">&lt;-</span> tmp_2 <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(tmp_type)</span>
<span id="cb26-478"><a href="#cb26-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-479"><a href="#cb26-479" aria-hidden="true" tabindex="-1"></a>  tmp_3 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(tmp_get<span class="sc">$</span>otu_table, <span class="sc">-</span><span class="fu">contains</span>(<span class="st">"E_SAMP"</span>))</span>
<span id="cb26-480"><a href="#cb26-480" aria-hidden="true" tabindex="-1"></a>  tmp_3<span class="sc">$</span>num_samp_SS <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(tmp_3 <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb26-481"><a href="#cb26-481" aria-hidden="true" tabindex="-1"></a>  tmp_3 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(tmp_3, <span class="fu">contains</span>(<span class="st">"num_samp_SS"</span>))</span>
<span id="cb26-482"><a href="#cb26-482" aria-hidden="true" tabindex="-1"></a>  tmp_3 <span class="ot">&lt;-</span> tmp_3 <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(tmp_type)</span>
<span id="cb26-483"><a href="#cb26-483" aria-hidden="true" tabindex="-1"></a>  <span class="co">#tmp_merge &lt;- get(str_replace(j, "_tmp", "_df"))</span></span>
<span id="cb26-484"><a href="#cb26-484" aria-hidden="true" tabindex="-1"></a>  tmp_merge <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_df"</span>)))</span>
<span id="cb26-485"><a href="#cb26-485" aria-hidden="true" tabindex="-1"></a>  tmp_ds_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_merge, tmp_1) <span class="sc">%&gt;%</span></span>
<span id="cb26-486"><a href="#cb26-486" aria-hidden="true" tabindex="-1"></a>                 dplyr<span class="sc">::</span><span class="fu">left_join</span>(., tmp_2) <span class="sc">%&gt;%</span></span>
<span id="cb26-487"><a href="#cb26-487" aria-hidden="true" tabindex="-1"></a>                 dplyr<span class="sc">::</span><span class="fu">left_join</span>(., tmp_3)</span>
<span id="cb26-488"><a href="#cb26-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-489"><a href="#cb26-489" aria-hidden="true" tabindex="-1"></a>  tmp_ds_df <span class="ot">&lt;-</span> tmp_ds_df <span class="sc">%&gt;%</span></span>
<span id="cb26-490"><a href="#cb26-490" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">perc_samp_in_ES =</span> <span class="dv">100</span><span class="sc">*</span>( num_samp_ES <span class="sc">/</span> (num_samp_ES <span class="sc">+</span> num_samp_SS)),</span>
<span id="cb26-491"><a href="#cb26-491" aria-hidden="true" tabindex="-1"></a>                <span class="at">.after =</span> <span class="st">"num_samp_SS"</span>)</span>
<span id="cb26-492"><a href="#cb26-492" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_df"</span>))</span>
<span id="cb26-493"><a href="#cb26-493" aria-hidden="true" tabindex="-1"></a>  <span class="co">#tmp_name &lt;- str_replace(j, "_tmp", "_df")</span></span>
<span id="cb26-494"><a href="#cb26-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_ds_df)</span>
<span id="cb26-495"><a href="#cb26-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb26-496"><a href="#cb26-496" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-497"><a href="#cb26-497" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span>
<span id="cb26-498"><a href="#cb26-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-499"><a href="#cb26-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-502"><a href="#cb26-502" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-503"><a href="#cb26-503" aria-hidden="true" tabindex="-1"></a>me_ds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"me_asv_df"</span>, <span class="st">"me_otu_df"</span>, <span class="st">"me_med_df"</span>)</span>
<span id="cb26-504"><a href="#cb26-504" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> me_ds) {</span>
<span id="cb26-505"><a href="#cb26-505" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(j)</span>
<span id="cb26-506"><a href="#cb26-506" aria-hidden="true" tabindex="-1"></a>  tmp_ds_df <span class="ot">&lt;-</span> tmp_get <span class="sc">%&gt;%</span> <span class="fu">filter</span>(perc_reads_in_ES <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">|</span> perc_samp_in_ES <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb26-507"><a href="#cb26-507" aria-hidden="true" tabindex="-1"></a>  tmp_name_df <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(j, <span class="st">"_df"</span>, <span class="st">"_env"</span>)</span>
<span id="cb26-508"><a href="#cb26-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_df, tmp_ds_df)</span>
<span id="cb26-509"><a href="#cb26-509" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-510"><a href="#cb26-510" aria-hidden="true" tabindex="-1"></a>  tmp_rem <span class="ot">&lt;-</span> tmp_ds_df[,<span class="dv">1</span>] <span class="sc">%&gt;%</span>  <span class="fu">unlist</span>(<span class="fu">strsplit</span>(., <span class="at">split =</span> <span class="st">", "</span>)) </span>
<span id="cb26-511"><a href="#cb26-511" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(j, <span class="st">"_df"</span>, <span class="st">"_env_rem"</span>)</span>
<span id="cb26-512"><a href="#cb26-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_rem)</span>
<span id="cb26-513"><a href="#cb26-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb26-514"><a href="#cb26-514" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-515"><a href="#cb26-515" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span>
<span id="cb26-516"><a href="#cb26-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-517"><a href="#cb26-517" aria-hidden="true" tabindex="-1"></a>me_ds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"me_asv"</span>, <span class="st">"me_otu"</span>, <span class="st">"me_med"</span>)</span>
<span id="cb26-518"><a href="#cb26-518" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> me_ds) {</span>
<span id="cb26-519"><a href="#cb26-519" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(j)</span>
<span id="cb26-520"><a href="#cb26-520" aria-hidden="true" tabindex="-1"></a>  tmp_es <span class="ot">&lt;-</span> microeco<span class="sc">::</span><span class="fu">clone</span>(tmp_get)</span>
<span id="cb26-521"><a href="#cb26-521" aria-hidden="true" tabindex="-1"></a>  tmp_rem <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_env_rem"</span>)))</span>
<span id="cb26-522"><a href="#cb26-522" aria-hidden="true" tabindex="-1"></a>  tmp_es<span class="sc">$</span>otu_table <span class="ot">&lt;-</span> tmp_es<span class="sc">$</span>otu_table <span class="sc">%&gt;%</span> </span>
<span id="cb26-523"><a href="#cb26-523" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="fu">row.names</span>(tmp_es<span class="sc">$</span>otu_table)  tmp_rem)</span>
<span id="cb26-524"><a href="#cb26-524" aria-hidden="true" tabindex="-1"></a>  tmp_es<span class="sc">$</span><span class="fu">tidy_dataset</span>()</span>
<span id="cb26-525"><a href="#cb26-525" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_es"</span>))</span>
<span id="cb26-526"><a href="#cb26-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_es)</span>
<span id="cb26-527"><a href="#cb26-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb26-528"><a href="#cb26-528" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-529"><a href="#cb26-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-530"><a href="#cb26-530" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_es"</span>)</span>
<span id="cb26-531"><a href="#cb26-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-532"><a href="#cb26-532" aria-hidden="true" tabindex="-1"></a>tmp_asv <span class="ot">&lt;-</span> me_asv_es<span class="sc">$</span><span class="fu">merge_samples</span>(<span class="st">"TAXON"</span>)</span>
<span id="cb26-533"><a href="#cb26-533" aria-hidden="true" tabindex="-1"></a>tmp_asv<span class="sc">$</span>otu_table</span>
<span id="cb26-534"><a href="#cb26-534" aria-hidden="true" tabindex="-1"></a>tmp_med <span class="ot">&lt;-</span> me_med_es<span class="sc">$</span><span class="fu">merge_samples</span>(<span class="st">"TAXON"</span>)</span>
<span id="cb26-535"><a href="#cb26-535" aria-hidden="true" tabindex="-1"></a>tmp_med<span class="sc">$</span>tax_table</span>
<span id="cb26-536"><a href="#cb26-536" aria-hidden="true" tabindex="-1"></a>tmp_otu <span class="ot">&lt;-</span> me_otu_es<span class="sc">$</span><span class="fu">merge_samples</span>(<span class="st">"TAXON"</span>)</span>
<span id="cb26-537"><a href="#cb26-537" aria-hidden="true" tabindex="-1"></a>tmp_otu<span class="sc">$</span>otu_table</span>
<span id="cb26-538"><a href="#cb26-538" aria-hidden="true" tabindex="-1"></a>me_asv_env</span>
<span id="cb26-539"><a href="#cb26-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-540"><a href="#cb26-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-541"><a href="#cb26-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-542"><a href="#cb26-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-545"><a href="#cb26-545" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-546"><a href="#cb26-546" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-547"><a href="#cb26-547" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-548"><a href="#cb26-548" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span>
<span id="cb26-549"><a href="#cb26-549" aria-hidden="true" tabindex="-1"></a>gdata<span class="sc">::</span><span class="fu">keep</span>(me_asv, me_asv_df, me_asv_env, me_asv_env_rem, me_asv_pb, </span>
<span id="cb26-550"><a href="#cb26-550" aria-hidden="true" tabindex="-1"></a>            me_med, me_med_df, me_med_env, me_med_env_rem, me_med_pb, </span>
<span id="cb26-551"><a href="#cb26-551" aria-hidden="true" tabindex="-1"></a>            me_otu, me_otu_df, me_otu_env, me_otu_env_rem, me_otu_pb,</span>
<span id="cb26-552"><a href="#cb26-552" aria-hidden="true" tabindex="-1"></a>            <span class="at">sure =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-553"><a href="#cb26-553" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(list = ls(pattern = "tmp_"))</span></span>
<span id="cb26-554"><a href="#cb26-554" aria-hidden="true" tabindex="-1"></a><span class="fu">save.image</span>(<span class="st">"files/rdata/compare_part1.rdata"</span>)</span>
<span id="cb26-555"><a href="#cb26-555" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-556"><a href="#cb26-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-559"><a href="#cb26-559" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-560"><a href="#cb26-560" aria-hidden="true" tabindex="-1"></a>me_ds <span class="ot">&lt;-</span> <span class="fu">clone</span>(me_med_pb)</span>
<span id="cb26-561"><a href="#cb26-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-562"><a href="#cb26-562" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> trans_alpha<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> me_ds, <span class="at">group =</span> <span class="st">"TISSUE"</span>)</span>
<span id="cb26-563"><a href="#cb26-563" aria-hidden="true" tabindex="-1"></a><span class="co"># return t1$data_stat</span></span>
<span id="cb26-564"><a href="#cb26-564" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(t1<span class="sc">$</span>data_stat)</span>
<span id="cb26-565"><a href="#cb26-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-566"><a href="#cb26-566" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">cal_diff</span>(<span class="at">method =</span> <span class="st">"KW"</span>)</span>
<span id="cb26-567"><a href="#cb26-567" aria-hidden="true" tabindex="-1"></a><span class="co"># return t1$res_diff</span></span>
<span id="cb26-568"><a href="#cb26-568" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(t1<span class="sc">$</span>res_diff)</span>
<span id="cb26-569"><a href="#cb26-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-570"><a href="#cb26-570" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">cal_diff</span>(<span class="at">method =</span> <span class="st">"KW_dunn"</span>)</span>
<span id="cb26-571"><a href="#cb26-571" aria-hidden="true" tabindex="-1"></a><span class="co"># return t1$res_diff</span></span>
<span id="cb26-572"><a href="#cb26-572" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(t1<span class="sc">$</span>res_diff)</span>
<span id="cb26-573"><a href="#cb26-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-574"><a href="#cb26-574" aria-hidden="true" tabindex="-1"></a><span class="co"># more options</span></span>
<span id="cb26-575"><a href="#cb26-575" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">cal_diff</span>(<span class="at">method =</span> <span class="st">"KW_dunn"</span>, <span class="at">KW_dunn_letter =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-576"><a href="#cb26-576" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(t1<span class="sc">$</span>res_diff)</span>
<span id="cb26-577"><a href="#cb26-577" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">cal_diff</span>(<span class="at">method =</span> <span class="st">"wilcox"</span>)</span>
<span id="cb26-578"><a href="#cb26-578" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(t1<span class="sc">$</span>res_diff)</span>
<span id="cb26-579"><a href="#cb26-579" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">cal_diff</span>(<span class="at">method =</span> <span class="st">"t.test"</span>)</span>
<span id="cb26-580"><a href="#cb26-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-581"><a href="#cb26-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-582"><a href="#cb26-582" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">cal_diff</span>(<span class="at">method =</span> <span class="st">"anova"</span>)</span>
<span id="cb26-583"><a href="#cb26-583" aria-hidden="true" tabindex="-1"></a><span class="co"># return t1$res_diff</span></span>
<span id="cb26-584"><a href="#cb26-584" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(t1<span class="sc">$</span>res_diff)</span>
<span id="cb26-585"><a href="#cb26-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-586"><a href="#cb26-586" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> trans_alpha<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> me_ds, <span class="at">group =</span> <span class="st">"TISSUE"</span>)</span>
<span id="cb26-587"><a href="#cb26-587" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">cal_diff</span>(<span class="at">method =</span> <span class="st">"anova"</span>, <span class="at">formula =</span> <span class="st">"TISSUE+OCEAN"</span>)</span>
<span id="cb26-588"><a href="#cb26-588" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(t1<span class="sc">$</span>res_diff)</span>
<span id="cb26-589"><a href="#cb26-589" aria-hidden="true" tabindex="-1"></a><span class="co"># see the help document for the usage of formula</span></span>
<span id="cb26-590"><a href="#cb26-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-591"><a href="#cb26-591" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">cal_diff</span>(<span class="at">method =</span> <span class="st">"anova"</span>)</span>
<span id="cb26-592"><a href="#cb26-592" aria-hidden="true" tabindex="-1"></a><span class="co"># y_increase can adjust the distance from the letters to the highest point</span></span>
<span id="cb26-593"><a href="#cb26-593" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">plot_alpha</span>(<span class="at">measure =</span> <span class="st">"Chao1"</span>, <span class="at">y_increase =</span> <span class="fl">0.3</span>)</span>
<span id="cb26-594"><a href="#cb26-594" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">plot_alpha</span>(<span class="at">measure =</span> <span class="st">"Chao1"</span>, <span class="at">y_increase =</span> <span class="fl">0.1</span>)</span>
<span id="cb26-595"><a href="#cb26-595" aria-hidden="true" tabindex="-1"></a><span class="co"># add_sig_text_size: letter size adjustment</span></span>
<span id="cb26-596"><a href="#cb26-596" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">plot_alpha</span>(<span class="at">measure =</span> <span class="st">"Chao1"</span>, <span class="at">add_sig_text_size =</span> <span class="dv">6</span>, <span class="at">add =</span> <span class="st">"jitter"</span>, <span class="at">order_x_mean =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-597"><a href="#cb26-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-598"><a href="#cb26-598" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">cal_diff</span>(<span class="at">method =</span> <span class="st">"wilcox"</span>)</span>
<span id="cb26-599"><a href="#cb26-599" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">plot_alpha</span>(<span class="at">measure =</span> <span class="st">"Chao1"</span>, <span class="at">shape =</span> <span class="st">"TISSUE"</span>)</span>
<span id="cb26-600"><a href="#cb26-600" aria-hidden="true" tabindex="-1"></a><span class="co"># y_start: starting height for the first label</span></span>
<span id="cb26-601"><a href="#cb26-601" aria-hidden="true" tabindex="-1"></a><span class="co"># y_increase: increased height for each label</span></span>
<span id="cb26-602"><a href="#cb26-602" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">plot_alpha</span>(<span class="at">measure =</span> <span class="st">"Chao1"</span>, <span class="at">shape =</span> <span class="st">"TISSUE"</span>, <span class="at">add =</span> <span class="st">"jitter"</span>, <span class="at">y_start =</span> <span class="fl">0.1</span>, <span class="at">y_increase =</span> <span class="fl">0.1</span>)</span>
<span id="cb26-603"><a href="#cb26-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-604"><a href="#cb26-604" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span>res_diff <span class="sc">%&lt;&gt;%</span> base<span class="sc">::</span><span class="fu">subset</span>(Significance <span class="sc">!=</span> <span class="st">"ns"</span>)</span>
<span id="cb26-605"><a href="#cb26-605" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">plot_alpha</span>(<span class="at">measure =</span> <span class="st">"Chao1"</span>, <span class="at">add =</span> <span class="st">"dotplot"</span>, <span class="at">xtext_size =</span> <span class="dv">15</span>)</span>
<span id="cb26-606"><a href="#cb26-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-607"><a href="#cb26-607" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> trans_alpha<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> me_ds, <span class="at">group =</span> <span class="st">"OCEAN"</span>, <span class="at">by_group =</span> <span class="st">"TISSUE"</span>)</span>
<span id="cb26-608"><a href="#cb26-608" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">cal_diff</span>(<span class="at">method =</span> <span class="st">"wilcox"</span>)</span>
<span id="cb26-609"><a href="#cb26-609" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">plot_alpha</span>(<span class="at">measure =</span> <span class="st">"Shannon"</span>)</span>
<span id="cb26-610"><a href="#cb26-610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-611"><a href="#cb26-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-614"><a href="#cb26-614" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-615"><a href="#cb26-615" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(t1)</span>
<span id="cb26-616"><a href="#cb26-616" aria-hidden="true" tabindex="-1"></a>me_ds<span class="sc">$</span><span class="fu">cal_betadiv</span>(<span class="at">unifrac =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-617"><a href="#cb26-617" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(me_ds<span class="sc">$</span>sample_table<span class="sc">$</span>PAIR)</span>
<span id="cb26-618"><a href="#cb26-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-619"><a href="#cb26-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-620"><a href="#cb26-620" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> trans_beta<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> me_ds, <span class="at">group =</span> <span class="st">"TISSUE"</span>, <span class="at">measure =</span> <span class="st">"bray"</span>)</span>
<span id="cb26-621"><a href="#cb26-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-622"><a href="#cb26-622" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">cal_ordination</span>(<span class="at">method =</span> <span class="st">"PCoA"</span>)</span>
<span id="cb26-623"><a href="#cb26-623" aria-hidden="true" tabindex="-1"></a><span class="co"># t1$res_ordination is the ordination result list</span></span>
<span id="cb26-624"><a href="#cb26-624" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(t1<span class="sc">$</span>res_ordination)</span>
<span id="cb26-625"><a href="#cb26-625" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the PCoA result with confidence ellipse</span></span>
<span id="cb26-626"><a href="#cb26-626" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">plot_ordination</span>(<span class="at">plot_color =</span> <span class="st">"TISSUE"</span>, <span class="at">plot_shape =</span> <span class="st">"OCEAN"</span>, <span class="at">plot_type =</span> <span class="fu">c</span>(<span class="st">"point"</span>, <span class="st">"ellipse"</span>))</span>
<span id="cb26-627"><a href="#cb26-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-628"><a href="#cb26-628" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-629"><a href="#cb26-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-630"><a href="#cb26-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-631"><a href="#cb26-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-632"><a href="#cb26-632" aria-hidden="true" tabindex="-1"></a>MERGE SAMPLES ANALYSIS</span>
<span id="cb26-633"><a href="#cb26-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-636"><a href="#cb26-636" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-637"><a href="#cb26-637" aria-hidden="true" tabindex="-1"></a>me_ds <span class="ot">&lt;-</span> <span class="fu">clone</span>(me_med_pb)</span>
<span id="cb26-638"><a href="#cb26-638" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> trans_abund<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> me_ds, <span class="at">taxrank =</span> <span class="st">"Phylum"</span>, <span class="at">ntaxa =</span> <span class="dv">10</span>, <span class="at">groupmean =</span> <span class="st">"TISSUE"</span>)</span>
<span id="cb26-639"><a href="#cb26-639" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> t1<span class="sc">$</span><span class="fu">plot_bar</span>(<span class="at">others_color =</span> <span class="st">"grey70"</span>, <span class="at">legend_text_italic =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-640"><a href="#cb26-640" aria-hidden="true" tabindex="-1"></a>g1 <span class="sc">+</span> <span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>))</span>
<span id="cb26-641"><a href="#cb26-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-642"><a href="#cb26-642" aria-hidden="true" tabindex="-1"></a><span class="co"># show 40 taxa at Genus level</span></span>
<span id="cb26-643"><a href="#cb26-643" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> trans_abund<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> me_ds, <span class="at">taxrank =</span> <span class="st">"Phylum"</span>, <span class="at">ntaxa =</span> <span class="dv">40</span>)</span>
<span id="cb26-644"><a href="#cb26-644" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> t1<span class="sc">$</span><span class="fu">plot_heatmap</span>(<span class="at">facet =</span> <span class="st">"TISSUE"</span>, <span class="at">xtext_keep =</span> <span class="cn">FALSE</span>, <span class="at">withmargin =</span> <span class="cn">FALSE</span>, <span class="at">plot_breaks =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>))</span>
<span id="cb26-645"><a href="#cb26-645" aria-hidden="true" tabindex="-1"></a>g1</span>
<span id="cb26-646"><a href="#cb26-646" aria-hidden="true" tabindex="-1"></a>g1 <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">'italic'</span>))</span>
<span id="cb26-647"><a href="#cb26-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-648"><a href="#cb26-648" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> trans_abund<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> me_ds, <span class="at">taxrank =</span> <span class="st">"Phylum"</span>, <span class="at">ntaxa =</span> <span class="dv">6</span>, <span class="at">groupmean =</span> <span class="st">"TISSUE"</span>)</span>
<span id="cb26-649"><a href="#cb26-649" aria-hidden="true" tabindex="-1"></a><span class="co"># all pie chart in one row</span></span>
<span id="cb26-650"><a href="#cb26-650" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">plot_pie</span>(<span class="at">facet_nrow =</span> <span class="dv">3</span>)</span>
<span id="cb26-651"><a href="#cb26-651" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">plot_pie</span>(<span class="at">facet_nrow =</span> <span class="dv">3</span>, <span class="at">add_label =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-652"><a href="#cb26-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-653"><a href="#cb26-653" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> trans_abund<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> me_ds, <span class="at">taxrank =</span> <span class="st">"Phylum"</span>, <span class="at">ntaxa =</span> <span class="dv">8</span>, <span class="at">groupmean =</span> <span class="st">"TISSUE"</span>)</span>
<span id="cb26-654"><a href="#cb26-654" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">plot_donut</span>(<span class="at">label =</span> <span class="cn">FALSE</span>, <span class="at">facet_nrow =</span> <span class="dv">3</span>)</span>
<span id="cb26-655"><a href="#cb26-655" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span><span class="fu">plot_donut</span>(<span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">facet_nrow =</span> <span class="dv">3</span>)</span>
<span id="cb26-656"><a href="#cb26-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-657"><a href="#cb26-657" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> trans_abund<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> me_ds, <span class="at">taxrank =</span> <span class="st">"Phylum"</span>, <span class="at">ntaxa =</span> <span class="dv">10</span>, <span class="at">groupmean =</span> <span class="st">"SPECIES"</span>)</span>
<span id="cb26-658"><a href="#cb26-658" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> t1<span class="sc">$</span><span class="fu">plot_bar</span>(<span class="at">coord_flip =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-659"><a href="#cb26-659" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> g1 <span class="sc">+</span> <span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>), <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.line.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb26-660"><a href="#cb26-660" aria-hidden="true" tabindex="-1"></a>g1</span>
<span id="cb26-661"><a href="#cb26-661" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> t1<span class="sc">$</span><span class="fu">plot_bar</span>(<span class="at">clustering_plot =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-662"><a href="#cb26-662" aria-hidden="true" tabindex="-1"></a><span class="co"># In this case, g1 (aplot object) is the combination of different ggplot objects</span></span>
<span id="cb26-663"><a href="#cb26-663" aria-hidden="true" tabindex="-1"></a><span class="co"># to adjust the main plot, please select g1[[1]]</span></span>
<span id="cb26-664"><a href="#cb26-664" aria-hidden="true" tabindex="-1"></a>g1[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> g1[[<span class="dv">1</span>]] <span class="sc">+</span> <span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>), <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.line.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb26-665"><a href="#cb26-665" aria-hidden="true" tabindex="-1"></a>g1</span>
<span id="cb26-666"><a href="#cb26-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-667"><a href="#cb26-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-668"><a href="#cb26-668" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> me_ds<span class="sc">$</span><span class="fu">merge_samples</span>(<span class="st">"TISSUE"</span>)</span>
<span id="cb26-669"><a href="#cb26-669" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> trans_venn<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> tmp)</span>
<span id="cb26-670"><a href="#cb26-670" aria-hidden="true" tabindex="-1"></a><span class="co"># only show some sets with large intersection numbers</span></span>
<span id="cb26-671"><a href="#cb26-671" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span>data_summary <span class="sc">%&lt;&gt;%</span> .[.[, <span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">20</span>, ]</span>
<span id="cb26-672"><a href="#cb26-672" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> t1<span class="sc">$</span><span class="fu">plot_bar</span>(<span class="at">left_plot =</span> <span class="cn">TRUE</span>, <span class="at">bottom_height =</span> <span class="fl">0.5</span>, <span class="at">left_width =</span> <span class="fl">0.15</span>, <span class="at">up_bar_fill =</span> <span class="st">"grey50"</span>, <span class="at">left_bar_fill =</span> <span class="st">"grey50"</span>, <span class="at">bottom_point_color =</span> <span class="st">"black"</span>)</span>
<span id="cb26-673"><a href="#cb26-673" aria-hidden="true" tabindex="-1"></a>g1</span>
<span id="cb26-674"><a href="#cb26-674" aria-hidden="true" tabindex="-1"></a><span class="co"># g1 is aplot class and can be saved with ggplot2::ggsave, aplot::ggsave or cowplot::save_plot function</span></span>
<span id="cb26-675"><a href="#cb26-675" aria-hidden="true" tabindex="-1"></a><span class="co"># as g1 is comprised of several sub-plots, please adjust the details for each sub-plot</span></span>
<span id="cb26-676"><a href="#cb26-676" aria-hidden="true" tabindex="-1"></a>g1[[<span class="dv">1</span>]]</span>
<span id="cb26-677"><a href="#cb26-677" aria-hidden="true" tabindex="-1"></a>g1[[<span class="dv">2</span>]]</span>
<span id="cb26-678"><a href="#cb26-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-679"><a href="#cb26-679" aria-hidden="true" tabindex="-1"></a>dataset1 <span class="ot">&lt;-</span> me_ds<span class="sc">$</span><span class="fu">merge_samples</span>(<span class="st">"TISSUE"</span>)</span>
<span id="cb26-680"><a href="#cb26-680" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> trans_venn<span class="sc">$</span><span class="fu">new</span>(dataset1)</span>
<span id="cb26-681"><a href="#cb26-681" aria-hidden="true" tabindex="-1"></a><span class="co"># transform venn results to the sample-species table, here do not consider abundance, only use presence/absence.</span></span>
<span id="cb26-682"><a href="#cb26-682" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> t1<span class="sc">$</span><span class="fu">trans_comm</span>(<span class="at">use_frequency =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-683"><a href="#cb26-683" aria-hidden="true" tabindex="-1"></a><span class="co"># t2 is a new microtable class, each part is considered a sample</span></span>
<span id="cb26-684"><a href="#cb26-684" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(t2)</span>
<span id="cb26-685"><a href="#cb26-685" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate taxa abundance, that is, the frequency</span></span>
<span id="cb26-686"><a href="#cb26-686" aria-hidden="true" tabindex="-1"></a>t2<span class="sc">$</span><span class="fu">cal_abund</span>()</span>
<span id="cb26-687"><a href="#cb26-687" aria-hidden="true" tabindex="-1"></a>t2<span class="sc">$</span>taxa_abund</span>
<span id="cb26-688"><a href="#cb26-688" aria-hidden="true" tabindex="-1"></a><span class="co"># transform and plot</span></span>
<span id="cb26-689"><a href="#cb26-689" aria-hidden="true" tabindex="-1"></a>t3 <span class="ot">&lt;-</span> trans_abund<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> t2, <span class="at">taxrank =</span> <span class="st">"Phylum"</span>, <span class="at">ntaxa =</span> <span class="dv">8</span>)</span>
<span id="cb26-690"><a href="#cb26-690" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(t3<span class="sc">$</span>data_abund<span class="sc">$</span>Sample)</span>
<span id="cb26-691"><a href="#cb26-691" aria-hidden="true" tabindex="-1"></a>t3<span class="sc">$</span><span class="fu">plot_bar</span>(<span class="at">bar_full =</span> <span class="cn">FALSE</span>, <span class="at">legend_text_italic =</span> T, <span class="at">xtext_angle =</span> <span class="dv">30</span>, <span class="at">color_values =</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Set2"</span>),</span>
<span id="cb26-692"><a href="#cb26-692" aria-hidden="true" tabindex="-1"></a>    <span class="at">order_x =</span> <span class="fu">c</span>(<span class="st">"IW"</span>, <span class="st">"CW"</span>, <span class="st">"TW"</span>, <span class="st">"IW&amp;CW"</span>, <span class="st">"IW&amp;TW"</span>, <span class="st">"CW&amp;TW"</span>, <span class="st">"IW&amp;CW&amp;TW"</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency (%)"</span>)</span>
<span id="cb26-693"><a href="#cb26-693" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-694"><a href="#cb26-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-695"><a href="#cb26-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-698"><a href="#cb26-698" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-699"><a href="#cb26-699" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(t3<span class="sc">$</span>data_abund<span class="sc">$</span>Sample)</span>
<span id="cb26-700"><a href="#cb26-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-701"><a href="#cb26-701" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-702"><a href="#cb26-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-703"><a href="#cb26-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-704"><a href="#cb26-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-705"><a href="#cb26-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-706"><a href="#cb26-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-707"><a href="#cb26-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-708"><a href="#cb26-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-709"><a href="#cb26-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-710"><a href="#cb26-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-711"><a href="#cb26-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-712"><a href="#cb26-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-713"><a href="#cb26-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-714"><a href="#cb26-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-715"><a href="#cb26-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-716"><a href="#cb26-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-717"><a href="#cb26-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-718"><a href="#cb26-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-719"><a href="#cb26-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-720"><a href="#cb26-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-721"><a href="#cb26-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-722"><a href="#cb26-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-723"><a href="#cb26-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-724"><a href="#cb26-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-727"><a href="#cb26-727" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-728"><a href="#cb26-728" aria-hidden="true" tabindex="-1"></a>me_ds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"me_med"</span>, <span class="st">"me_asv"</span>, <span class="st">"me_otu"</span>)</span>
<span id="cb26-729"><a href="#cb26-729" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> me_ds) {</span>
<span id="cb26-730"><a href="#cb26-730" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(j)</span>
<span id="cb26-731"><a href="#cb26-731" aria-hidden="true" tabindex="-1"></a>  tmp_get_tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_get<span class="sc">$</span>otu_table)</span>
<span id="cb26-732"><a href="#cb26-732" aria-hidden="true" tabindex="-1"></a>  tmp_get_tab <span class="ot">&lt;-</span> tmp_get_tab <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"ID"</span>)</span>
<span id="cb26-733"><a href="#cb26-733" aria-hidden="true" tabindex="-1"></a>  tmp_get_tab <span class="ot">&lt;-</span> jamba<span class="sc">::</span><span class="fu">mixedSortDF</span>(tmp_get_tab, <span class="at">decreasing =</span> <span class="cn">FALSE</span>, </span>
<span id="cb26-734"><a href="#cb26-734" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">useRownames =</span> <span class="cn">FALSE</span>, <span class="at">byCols =</span> <span class="dv">1</span>)</span>
<span id="cb26-735"><a href="#cb26-735" aria-hidden="true" tabindex="-1"></a>  tmp_get_tab <span class="ot">&lt;-</span> tmp_get_tab <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">remove_rownames</span>() </span>
<span id="cb26-736"><a href="#cb26-736" aria-hidden="true" tabindex="-1"></a>  tmp_get_tab <span class="ot">&lt;-</span> tmp_get_tab <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"ID"</span>)</span>
<span id="cb26-737"><a href="#cb26-737" aria-hidden="true" tabindex="-1"></a>  tmp_get_tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(tmp_get_tab))</span>
<span id="cb26-738"><a href="#cb26-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-739"><a href="#cb26-739" aria-hidden="true" tabindex="-1"></a>  tmp_get_tab_ord <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_get<span class="sc">$</span>otu_table)</span>
<span id="cb26-740"><a href="#cb26-740" aria-hidden="true" tabindex="-1"></a>  tmp_get_tab_ord <span class="ot">&lt;-</span> tmp_get_tab_ord <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"ID"</span>)</span>
<span id="cb26-741"><a href="#cb26-741" aria-hidden="true" tabindex="-1"></a>  tmp_get_tab_ord <span class="ot">&lt;-</span> jamba<span class="sc">::</span><span class="fu">mixedSortDF</span>(tmp_get_tab_ord, <span class="at">decreasing =</span> <span class="cn">TRUE</span>, </span>
<span id="cb26-742"><a href="#cb26-742" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">useRownames =</span> <span class="cn">FALSE</span>, <span class="at">byCols =</span> <span class="dv">1</span>)</span>
<span id="cb26-743"><a href="#cb26-743" aria-hidden="true" tabindex="-1"></a>  tmp_get_tab_ord <span class="ot">&lt;-</span> tmp_get_tab_ord <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">remove_rownames</span>() </span>
<span id="cb26-744"><a href="#cb26-744" aria-hidden="true" tabindex="-1"></a>  tmp_get_tab_ord <span class="ot">&lt;-</span> tmp_get_tab_ord <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"ID"</span>)</span>
<span id="cb26-745"><a href="#cb26-745" aria-hidden="true" tabindex="-1"></a>  tmp_get_tab_ord <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(tmp_get_tab_ord))</span>
<span id="cb26-746"><a href="#cb26-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-747"><a href="#cb26-747" aria-hidden="true" tabindex="-1"></a>  tmp_tab_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_perfect"</span>))</span>
<span id="cb26-748"><a href="#cb26-748" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_tab_name, tmp_get_tab)</span>
<span id="cb26-749"><a href="#cb26-749" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-750"><a href="#cb26-750" aria-hidden="true" tabindex="-1"></a>  tmp_tab_ord_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_ord_perfect"</span>))</span>
<span id="cb26-751"><a href="#cb26-751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_tab_ord_name, tmp_get_tab_ord)</span>
<span id="cb26-752"><a href="#cb26-752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb26-753"><a href="#cb26-753" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-754"><a href="#cb26-754" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-755"><a href="#cb26-755" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_perfect"</span>)</span>
<span id="cb26-756"><a href="#cb26-756" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(me_med_perfect)</span>
<span id="cb26-757"><a href="#cb26-757" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(me_med_ord_perfect)</span>
<span id="cb26-758"><a href="#cb26-758" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(me_asv_perfect)</span>
<span id="cb26-759"><a href="#cb26-759" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(me_asv_ord_perfect)</span>
<span id="cb26-760"><a href="#cb26-760" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(me_otu_perfect)</span>
<span id="cb26-761"><a href="#cb26-761" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(me_otu_ord_perfect)</span>
<span id="cb26-762"><a href="#cb26-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-763"><a href="#cb26-763" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-764"><a href="#cb26-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-767"><a href="#cb26-767" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-768"><a href="#cb26-768" aria-hidden="true" tabindex="-1"></a><span class="co">#me_ds &lt;- c("me_med", "me_asv", "me_otu")</span></span>
<span id="cb26-769"><a href="#cb26-769" aria-hidden="true" tabindex="-1"></a>me_ds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"me_med"</span>)</span>
<span id="cb26-770"><a href="#cb26-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-771"><a href="#cb26-771" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PERFect)</span>
<span id="cb26-772"><a href="#cb26-772" aria-hidden="true" tabindex="-1"></a>per_pval <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb26-773"><a href="#cb26-773" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> me_ds) {</span>
<span id="cb26-774"><a href="#cb26-774" aria-hidden="true" tabindex="-1"></a>  tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"files/rdata/"</span>)</span>
<span id="cb26-775"><a href="#cb26-775" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_perfect"</span>)))</span>
<span id="cb26-776"><a href="#cb26-776" aria-hidden="true" tabindex="-1"></a>  tmp_pval <span class="ot">&lt;-</span> per_pval</span>
<span id="cb26-777"><a href="#cb26-777" aria-hidden="true" tabindex="-1"></a>  tmp_get_ord <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_ord_perfect"</span>)))</span>
<span id="cb26-778"><a href="#cb26-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-779"><a href="#cb26-779" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Running PERFect_sim on default"</span>)</span>
<span id="cb26-780"><a href="#cb26-780" aria-hidden="true" tabindex="-1"></a>  tmp_sim <span class="ot">&lt;-</span> <span class="fu">PERFect_sim</span>(<span class="at">X =</span> tmp_get, <span class="at">alpha =</span> tmp_pval, <span class="at">Order =</span> <span class="st">"NP"</span>, <span class="at">center =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-781"><a href="#cb26-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Finished running PERFect_sim on default"</span>)</span>
<span id="cb26-782"><a href="#cb26-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(tmp_sim<span class="sc">$</span>filtX)</span>
<span id="cb26-783"><a href="#cb26-783" aria-hidden="true" tabindex="-1"></a>  tmp_sim_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_perfect_sim"</span>))</span>
<span id="cb26-784"><a href="#cb26-784" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_sim_name, tmp_sim)</span>
<span id="cb26-785"><a href="#cb26-785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(tmp_sim, <span class="fu">paste</span>(tmp_path, tmp_sim_name, <span class="st">".rds"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb26-786"><a href="#cb26-786" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-787"><a href="#cb26-787" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Running PERFect_sim on Ordered"</span>)</span>
<span id="cb26-788"><a href="#cb26-788" aria-hidden="true" tabindex="-1"></a>  tmp_sim_ord <span class="ot">&lt;-</span> <span class="fu">PERFect_sim</span>(<span class="at">X =</span> tmp_get_ord, <span class="at">alpha =</span> tmp_pval, <span class="at">Order =</span> <span class="st">"NP"</span>, <span class="at">center =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-789"><a href="#cb26-789" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(tmp_sim_ord<span class="sc">$</span>filtX)</span>
<span id="cb26-790"><a href="#cb26-790" aria-hidden="true" tabindex="-1"></a>  tmp_sim_ord_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_ord_perfect_sim"</span>))</span>
<span id="cb26-791"><a href="#cb26-791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Finished running PERFect_sim on Ordered"</span>)</span>
<span id="cb26-792"><a href="#cb26-792" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_sim_ord_name, tmp_sim_ord)</span>
<span id="cb26-793"><a href="#cb26-793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(tmp_sim_ord, <span class="fu">paste</span>(tmp_path, tmp_sim_ord_name, <span class="st">".rds"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb26-794"><a href="#cb26-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-795"><a href="#cb26-795" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb26-796"><a href="#cb26-796" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-797"><a href="#cb26-797" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-798"><a href="#cb26-798" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_sim"</span>)</span>
<span id="cb26-799"><a href="#cb26-799" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(me_med_ord_perfect_sim<span class="sc">$</span>filtX)</span>
<span id="cb26-800"><a href="#cb26-800" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(me_med_perfect_sim<span class="sc">$</span>filtX)[<span class="dv">2</span>]</span>
<span id="cb26-801"><a href="#cb26-801" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(me_med_perfect_sim<span class="sc">$</span>pvals)</span>
<span id="cb26-802"><a href="#cb26-802" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(me_med_ord_perfect_sim<span class="sc">$</span>pvals)</span>
<span id="cb26-803"><a href="#cb26-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-804"><a href="#cb26-804" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-805"><a href="#cb26-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-806"><a href="#cb26-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-809"><a href="#cb26-809" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-810"><a href="#cb26-810" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hold</span></span>
<span id="cb26-811"><a href="#cb26-811" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total 16S rRNA ASVs with p-value less than"</span>, ssu_per_pval[<span class="dv">1</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb26-812"><a href="#cb26-812" aria-hidden="true" tabindex="-1"></a>tmp_df <span class="ot">&lt;-</span> ssu_default_pvals</span>
<span id="cb26-813"><a href="#cb26-813" aria-hidden="true" tabindex="-1"></a>tmp_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_df)</span>
<span id="cb26-814"><a href="#cb26-814" aria-hidden="true" tabindex="-1"></a>pval_asv <span class="ot">&lt;-</span> tmp_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(tmp_df <span class="sc">&lt;=</span> ssu_per_pval))</span>
<span id="cb26-815"><a href="#cb26-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-816"><a href="#cb26-816" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"default order: ASVs before checking p value was"</span>, </span>
<span id="cb26-817"><a href="#cb26-817" aria-hidden="true" tabindex="-1"></a>            ssu_default_num_asvs, </span>
<span id="cb26-818"><a href="#cb26-818" aria-hidden="true" tabindex="-1"></a>            <span class="st">"and after was"</span>, </span>
<span id="cb26-819"><a href="#cb26-819" aria-hidden="true" tabindex="-1"></a>            pval_asv<span class="sc">$</span>count[<span class="dv">1</span>]), </span>
<span id="cb26-820"><a href="#cb26-820" aria-hidden="true" tabindex="-1"></a>      <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-821"><a href="#cb26-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-822"><a href="#cb26-822" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"--------------------------------------"</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-823"><a href="#cb26-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-824"><a href="#cb26-824" aria-hidden="true" tabindex="-1"></a>tmp_df <span class="ot">&lt;-</span> ssu_ord_pvals</span>
<span id="cb26-825"><a href="#cb26-825" aria-hidden="true" tabindex="-1"></a>tmp_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_df)</span>
<span id="cb26-826"><a href="#cb26-826" aria-hidden="true" tabindex="-1"></a>pval_asv_ord <span class="ot">&lt;-</span> tmp_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(tmp_df <span class="sc">&lt;=</span> ssu_per_pval))</span>
<span id="cb26-827"><a href="#cb26-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-828"><a href="#cb26-828" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"decreasing order: ASVs before checking p value was"</span>, </span>
<span id="cb26-829"><a href="#cb26-829" aria-hidden="true" tabindex="-1"></a>            ssu_ord_num_asvs, <span class="st">"and after was"</span>, </span>
<span id="cb26-830"><a href="#cb26-830" aria-hidden="true" tabindex="-1"></a>            pval_asv_ord<span class="sc">$</span>count[<span class="dv">1</span>]), </span>
<span id="cb26-831"><a href="#cb26-831" aria-hidden="true" tabindex="-1"></a>      <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-832"><a href="#cb26-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-833"><a href="#cb26-833" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-834"><a href="#cb26-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-835"><a href="#cb26-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-836"><a href="#cb26-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-837"><a href="#cb26-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-840"><a href="#cb26-840" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-841"><a href="#cb26-841" aria-hidden="true" tabindex="-1"></a>tmp_a <span class="sc">%&gt;%</span> </span>
<span id="cb26-842"><a href="#cb26-842" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="fu">if_any</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">str_detect</span>(.x, <span class="st">'OTU_132'</span>)))</span>
<span id="cb26-843"><a href="#cb26-843" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-844"><a href="#cb26-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-847"><a href="#cb26-847" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-848"><a href="#cb26-848" aria-hidden="true" tabindex="-1"></a><span class="co">#prep for https://env-med.shinyapps.io/microbiem/</span></span>
<span id="cb26-849"><a href="#cb26-849" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> me_asv<span class="sc">$</span>tax_table</span>
<span id="cb26-850"><a href="#cb26-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-851"><a href="#cb26-851" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> tmp_tax <span class="sc">%&gt;%</span> <span class="fu">mutate_all</span>(<span class="fu">funs</span>(<span class="fu">str_replace_all</span>(., <span class="st">"[a-z]__"</span>, <span class="st">""</span>)))</span>
<span id="cb26-852"><a href="#cb26-852" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> tmp_tax <span class="sc">%&gt;%</span> <span class="fu">unite</span>(<span class="st">"Taxonomy"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">remove =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb26-853"><a href="#cb26-853" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(tmp_tax, <span class="st">"OTU_ID"</span>)</span>
<span id="cb26-854"><a href="#cb26-854" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sapply</span>(tmp_tax, </span>
<span id="cb26-855"><a href="#cb26-855" aria-hidden="true" tabindex="-1"></a>                             gsub, </span>
<span id="cb26-856"><a href="#cb26-856" aria-hidden="true" tabindex="-1"></a>                             <span class="at">pattern =</span> <span class="st">";+$"</span>, </span>
<span id="cb26-857"><a href="#cb26-857" aria-hidden="true" tabindex="-1"></a>                             <span class="at">replacement =</span> <span class="st">""</span>))</span>
<span id="cb26-858"><a href="#cb26-858" aria-hidden="true" tabindex="-1"></a>tmp_tax</span>
<span id="cb26-859"><a href="#cb26-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-860"><a href="#cb26-860" aria-hidden="true" tabindex="-1"></a>tmp_asv <span class="ot">&lt;-</span> me_asv<span class="sc">$</span>otu_table</span>
<span id="cb26-861"><a href="#cb26-861" aria-hidden="true" tabindex="-1"></a>tmp_asv <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(tmp_asv, <span class="st">"OTU_ID"</span>)</span>
<span id="cb26-862"><a href="#cb26-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-863"><a href="#cb26-863" aria-hidden="true" tabindex="-1"></a>asv_miem_feature <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_asv, tmp_tax, <span class="at">by =</span> <span class="st">"OTU_ID"</span>)</span>
<span id="cb26-864"><a href="#cb26-864" aria-hidden="true" tabindex="-1"></a><span class="fu">write_delim</span>(asv_miem_feature, <span class="st">"asv_miem_feature.txt"</span>, <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb26-865"><a href="#cb26-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-866"><a href="#cb26-866" aria-hidden="true" tabindex="-1"></a>tmp_samp <span class="ot">&lt;-</span> me_asv<span class="sc">$</span>sample_table</span>
<span id="cb26-867"><a href="#cb26-867" aria-hidden="true" tabindex="-1"></a>tmp_samp <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(tmp_samp, <span class="st">"Sample_ID"</span>)</span>
<span id="cb26-868"><a href="#cb26-868" aria-hidden="true" tabindex="-1"></a>tmp_samp<span class="sc">$</span>SampleID <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb26-869"><a href="#cb26-869" aria-hidden="true" tabindex="-1"></a>tmp_samp<span class="sc">$</span>Sample_type <span class="ot">&lt;-</span> <span class="st">"SAMPLE"</span></span>
<span id="cb26-870"><a href="#cb26-870" aria-hidden="true" tabindex="-1"></a>asv_miem_sample <span class="ot">&lt;-</span> tmp_samp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">relocate</span>(Sample_type, <span class="at">.after =</span> <span class="st">"Sample_ID"</span>)</span>
<span id="cb26-871"><a href="#cb26-871" aria-hidden="true" tabindex="-1"></a><span class="fu">write_delim</span>(asv_miem_sample, <span class="st">"asv_miem_sample.txt"</span>, <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb26-872"><a href="#cb26-872" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-873"><a href="#cb26-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-876"><a href="#cb26-876" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-877"><a href="#cb26-877" aria-hidden="true" tabindex="-1"></a><span class="co">#prep for https://env-med.shinyapps.io/microbiem/</span></span>
<span id="cb26-878"><a href="#cb26-878" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> me_asv<span class="sc">$</span>tax_table</span>
<span id="cb26-879"><a href="#cb26-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-880"><a href="#cb26-880" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> tmp_tax <span class="sc">%&gt;%</span> <span class="fu">mutate_all</span>(<span class="fu">funs</span>(<span class="fu">str_replace_all</span>(., <span class="st">"[a-z]__"</span>, <span class="st">""</span>)))</span>
<span id="cb26-881"><a href="#cb26-881" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> tmp_tax <span class="sc">%&gt;%</span> <span class="fu">unite</span>(<span class="st">"Taxonomy"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">remove =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb26-882"><a href="#cb26-882" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(tmp_tax, <span class="st">"OTU_ID"</span>)</span>
<span id="cb26-883"><a href="#cb26-883" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sapply</span>(tmp_tax, </span>
<span id="cb26-884"><a href="#cb26-884" aria-hidden="true" tabindex="-1"></a>                             gsub, </span>
<span id="cb26-885"><a href="#cb26-885" aria-hidden="true" tabindex="-1"></a>                             <span class="at">pattern =</span> <span class="st">";+$"</span>, </span>
<span id="cb26-886"><a href="#cb26-886" aria-hidden="true" tabindex="-1"></a>                             <span class="at">replacement =</span> <span class="st">""</span>))</span>
<span id="cb26-887"><a href="#cb26-887" aria-hidden="true" tabindex="-1"></a>tmp_tax</span>
<span id="cb26-888"><a href="#cb26-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-889"><a href="#cb26-889" aria-hidden="true" tabindex="-1"></a>tmp_asv <span class="ot">&lt;-</span> me_asv<span class="sc">$</span>otu_table</span>
<span id="cb26-890"><a href="#cb26-890" aria-hidden="true" tabindex="-1"></a>tmp_asv <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(tmp_asv, <span class="st">"OTU_ID"</span>)</span>
<span id="cb26-891"><a href="#cb26-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-892"><a href="#cb26-892" aria-hidden="true" tabindex="-1"></a>asv_miem_feature <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_asv, tmp_tax, <span class="at">by =</span> <span class="st">"OTU_ID"</span>)</span>
<span id="cb26-893"><a href="#cb26-893" aria-hidden="true" tabindex="-1"></a><span class="fu">write_delim</span>(asv_miem_feature, <span class="st">"asv_miem_feature.txt"</span>, <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb26-894"><a href="#cb26-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-895"><a href="#cb26-895" aria-hidden="true" tabindex="-1"></a>tmp_samp <span class="ot">&lt;-</span> me_asv<span class="sc">$</span>sample_table</span>
<span id="cb26-896"><a href="#cb26-896" aria-hidden="true" tabindex="-1"></a>tmp_samp <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(tmp_samp, <span class="st">"Sample_ID"</span>)</span>
<span id="cb26-897"><a href="#cb26-897" aria-hidden="true" tabindex="-1"></a>tmp_samp<span class="sc">$</span>SampleID <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb26-898"><a href="#cb26-898" aria-hidden="true" tabindex="-1"></a>tmp_samp<span class="sc">$</span>Sample_type <span class="ot">&lt;-</span> <span class="st">"SAMPLE"</span></span>
<span id="cb26-899"><a href="#cb26-899" aria-hidden="true" tabindex="-1"></a>asv_miem_sample <span class="ot">&lt;-</span> tmp_samp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">relocate</span>(Sample_type, <span class="at">.after =</span> <span class="st">"Sample_ID"</span>)</span>
<span id="cb26-900"><a href="#cb26-900" aria-hidden="true" tabindex="-1"></a><span class="fu">write_delim</span>(asv_miem_sample, <span class="st">"asv_miem_sample.txt"</span>, <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb26-901"><a href="#cb26-901" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-902"><a href="#cb26-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-903"><a href="#cb26-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-906"><a href="#cb26-906" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-907"><a href="#cb26-907" aria-hidden="true" tabindex="-1"></a><span class="co">#prep for https://env-med.shinyapps.io/microbiem/</span></span>
<span id="cb26-908"><a href="#cb26-908" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> me_med<span class="sc">$</span>tax_table</span>
<span id="cb26-909"><a href="#cb26-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-910"><a href="#cb26-910" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> tmp_tax <span class="sc">%&gt;%</span> <span class="fu">mutate_all</span>(<span class="fu">funs</span>(<span class="fu">str_replace_all</span>(., <span class="st">"[a-z]__"</span>, <span class="st">""</span>)))</span>
<span id="cb26-911"><a href="#cb26-911" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> tmp_tax <span class="sc">%&gt;%</span> <span class="fu">unite</span>(<span class="st">"Taxonomy"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">remove =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb26-912"><a href="#cb26-912" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(tmp_tax, <span class="st">"OTU_ID"</span>)</span>
<span id="cb26-913"><a href="#cb26-913" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sapply</span>(tmp_tax, </span>
<span id="cb26-914"><a href="#cb26-914" aria-hidden="true" tabindex="-1"></a>                             gsub, </span>
<span id="cb26-915"><a href="#cb26-915" aria-hidden="true" tabindex="-1"></a>                             <span class="at">pattern =</span> <span class="st">";+$"</span>, </span>
<span id="cb26-916"><a href="#cb26-916" aria-hidden="true" tabindex="-1"></a>                             <span class="at">replacement =</span> <span class="st">""</span>))</span>
<span id="cb26-917"><a href="#cb26-917" aria-hidden="true" tabindex="-1"></a>tmp_tax</span>
<span id="cb26-918"><a href="#cb26-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-919"><a href="#cb26-919" aria-hidden="true" tabindex="-1"></a>tmp_asv <span class="ot">&lt;-</span> me_med<span class="sc">$</span>otu_table</span>
<span id="cb26-920"><a href="#cb26-920" aria-hidden="true" tabindex="-1"></a>tmp_asv <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(tmp_asv, <span class="st">"OTU_ID"</span>)</span>
<span id="cb26-921"><a href="#cb26-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-922"><a href="#cb26-922" aria-hidden="true" tabindex="-1"></a>med_miem_feature <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_asv, tmp_tax, <span class="at">by =</span> <span class="st">"OTU_ID"</span>)</span>
<span id="cb26-923"><a href="#cb26-923" aria-hidden="true" tabindex="-1"></a><span class="fu">write_delim</span>(med_miem_feature, <span class="st">"med_miem_feature.txt"</span>, <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb26-924"><a href="#cb26-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-925"><a href="#cb26-925" aria-hidden="true" tabindex="-1"></a>tmp_samp <span class="ot">&lt;-</span> me_med<span class="sc">$</span>sample_table</span>
<span id="cb26-926"><a href="#cb26-926" aria-hidden="true" tabindex="-1"></a>tmp_samp <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(tmp_samp, <span class="st">"Sample_ID"</span>)</span>
<span id="cb26-927"><a href="#cb26-927" aria-hidden="true" tabindex="-1"></a>tmp_samp<span class="sc">$</span>SampleID <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb26-928"><a href="#cb26-928" aria-hidden="true" tabindex="-1"></a>tmp_samp<span class="sc">$</span>Sample_type <span class="ot">&lt;-</span> tmp_samp<span class="sc">$</span>Sample_ID</span>
<span id="cb26-929"><a href="#cb26-929" aria-hidden="true" tabindex="-1"></a>med_miem_sample <span class="ot">&lt;-</span> tmp_samp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">relocate</span>(Sample_type, <span class="at">.after =</span> <span class="st">"Sample_ID"</span>)</span>
<span id="cb26-930"><a href="#cb26-930" aria-hidden="true" tabindex="-1"></a>med_miem_sample <span class="ot">&lt;-</span> med_miem_sample <span class="sc">%&gt;%</span></span>
<span id="cb26-931"><a href="#cb26-931" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="st">"Sample_type"</span>, str_replace, <span class="st">"^.*E_SAMP.*"</span>, <span class="st">"POS1"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-932"><a href="#cb26-932" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="st">"Sample_type"</span>, str_replace, <span class="st">"^.*A_.*"</span>, <span class="st">"SAMPLE"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-933"><a href="#cb26-933" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="st">"Sample_type"</span>, str_replace, <span class="st">"^.*UNKN.*"</span>, <span class="st">"SAMPLE"</span>))</span>
<span id="cb26-934"><a href="#cb26-934" aria-hidden="true" tabindex="-1"></a><span class="fu">write_delim</span>(med_miem_sample, <span class="st">"med_miem_sample.txt"</span>, <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb26-935"><a href="#cb26-935" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-936"><a href="#cb26-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-937"><a href="#cb26-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-938"><a href="#cb26-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-939"><a href="#cb26-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-940"><a href="#cb26-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-941"><a href="#cb26-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-942"><a href="#cb26-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-943"><a href="#cb26-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-944"><a href="#cb26-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-945"><a href="#cb26-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-946"><a href="#cb26-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-947"><a href="#cb26-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-948"><a href="#cb26-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-951"><a href="#cb26-951" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-952"><a href="#cb26-952" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb26-953"><a href="#cb26-953" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-954"><a href="#cb26-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-955"><a href="#cb26-955" aria-hidden="true" tabindex="-1"></a><span class="fu">citation</span>(<span class="st">"microeco"</span>)</span>
<span id="cb26-956"><a href="#cb26-956" aria-hidden="true" tabindex="-1"></a><span class="fu">citation</span>(<span class="st">"mia"</span>)</span>
<span id="cb26-957"><a href="#cb26-957" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-958"><a href="#cb26-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-959"><a href="#cb26-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-960"><a href="#cb26-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-961"><a href="#cb26-961" aria-hidden="true" tabindex="-1"></a><span class="fu">## Rename NA taxonomic ranks</span></span>
<span id="cb26-962"><a href="#cb26-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-963"><a href="#cb26-963" aria-hidden="true" tabindex="-1"></a>Phyloseq has an odd way of dealing with taxonomic ranks that have no value---in other words, **NA** in the tax table. The first thing we are going to do before moving forward is to change all of the *NA*s to have a value of the next highest classified rank. For example, `ASV26` is not classified at the Genus level but is at Family level (Xanthobacteraceae). So we change the Genus name to *Family_Xanthobacteraceae*. The code for comes from these two posts on the phyloseq GitHub, both by <span class="co">[</span><span class="ot">MSMortensen</span><span class="co">](https://github.com/MSMortensen)</span>: issue <span class="co">[</span><span class="ot">#850</span><span class="co">](https://github.com/joey711/phyloseq/issues/850#issuecomment-394771087)</span> and issue <span class="co">[</span><span class="ot">#990</span><span class="co">](https://github.com/joey711/phyloseq/issues/990#issuecomment-424618425)</span>.</span>
<span id="cb26-964"><a href="#cb26-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-965"><a href="#cb26-965" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; One thing this code does is reassign the functions </span><span class="in">`class`</span><span class="at"> and </span><span class="in">`order`</span><span class="at"> to taxonomic ranks. This can cause issues if you need these functions.</span></span>
<span id="cb26-966"><a href="#cb26-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-967"><a href="#cb26-967" aria-hidden="true" tabindex="-1"></a>So you need to run something like this <span class="in">`rm(class, order, phylum, kingdom)`</span> at the end of the code to remove these as variables. For now, I have not come up with a better solution.</span>
<span id="cb26-968"><a href="#cb26-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-971"><a href="#cb26-971" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-972"><a href="#cb26-972" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb26-973"><a href="#cb26-973" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-974"><a href="#cb26-974" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb26-975"><a href="#cb26-975" aria-hidden="true" tabindex="-1"></a>ps_moth <span class="ot">&lt;-</span> ps_moth_nc</span>
<span id="cb26-976"><a href="#cb26-976" aria-hidden="true" tabindex="-1"></a>tax.clean <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(ps_moth))</span>
<span id="cb26-977"><a href="#cb26-977" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>){ tax.clean[,i] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tax.clean[,i])}</span>
<span id="cb26-978"><a href="#cb26-978" aria-hidden="true" tabindex="-1"></a>tax.clean[<span class="fu">is.na</span>(tax.clean)] <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb26-979"><a href="#cb26-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-980"><a href="#cb26-980" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(tax.clean)){</span>
<span id="cb26-981"><a href="#cb26-981" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (tax.clean[i,<span class="dv">2</span>] <span class="sc">==</span> <span class="st">""</span>){</span>
<span id="cb26-982"><a href="#cb26-982" aria-hidden="true" tabindex="-1"></a>        kingdom <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"k_"</span>, tax.clean[i,<span class="dv">1</span>], <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb26-983"><a href="#cb26-983" aria-hidden="true" tabindex="-1"></a>        tax.clean[i, <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>] <span class="ot">&lt;-</span> kingdom</span>
<span id="cb26-984"><a href="#cb26-984" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (tax.clean[i,<span class="dv">3</span>] <span class="sc">==</span> <span class="st">""</span>){</span>
<span id="cb26-985"><a href="#cb26-985" aria-hidden="true" tabindex="-1"></a>        phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"p_"</span>, tax.clean[i,<span class="dv">2</span>], <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb26-986"><a href="#cb26-986" aria-hidden="true" tabindex="-1"></a>        tax.clean[i, <span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb26-987"><a href="#cb26-987" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (tax.clean[i,<span class="dv">4</span>] <span class="sc">==</span> <span class="st">""</span>){</span>
<span id="cb26-988"><a href="#cb26-988" aria-hidden="true" tabindex="-1"></a>        class <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"c_"</span>, tax.clean[i,<span class="dv">3</span>], <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb26-989"><a href="#cb26-989" aria-hidden="true" tabindex="-1"></a>        tax.clean[i, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>] <span class="ot">&lt;-</span> class</span>
<span id="cb26-990"><a href="#cb26-990" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (tax.clean[i,<span class="dv">5</span>] <span class="sc">==</span> <span class="st">""</span>){</span>
<span id="cb26-991"><a href="#cb26-991" aria-hidden="true" tabindex="-1"></a>        order <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"o_"</span>, tax.clean[i,<span class="dv">4</span>], <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb26-992"><a href="#cb26-992" aria-hidden="true" tabindex="-1"></a>        tax.clean[i, <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>] <span class="ot">&lt;-</span> order</span>
<span id="cb26-993"><a href="#cb26-993" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (tax.clean[i,<span class="dv">6</span>] <span class="sc">==</span> <span class="st">""</span>){</span>
<span id="cb26-994"><a href="#cb26-994" aria-hidden="true" tabindex="-1"></a>        tax.clean<span class="sc">$</span>Genus[i] <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"f"</span>,tax.clean<span class="sc">$</span>Family[i], <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb26-995"><a href="#cb26-995" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb26-996"><a href="#cb26-996" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-997"><a href="#cb26-997" aria-hidden="true" tabindex="-1"></a><span class="fu">tax_table</span>(ps_moth) <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tax.clean)</span>
<span id="cb26-998"><a href="#cb26-998" aria-hidden="true" tabindex="-1"></a><span class="fu">rank_names</span>(ps_moth)</span>
<span id="cb26-999"><a href="#cb26-999" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(class, order, phylum, kingdom, i)</span>
<span id="cb26-1000"><a href="#cb26-1000" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-1001"><a href="#cb26-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1002"><a href="#cb26-1002" aria-hidden="true" tabindex="-1"></a>Still the same ranks. That's good. What about the new groups? Let's take a peak at some families.</span>
<span id="cb26-1003"><a href="#cb26-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1006"><a href="#cb26-1006" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-1007"><a href="#cb26-1007" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb26-1008"><a href="#cb26-1008" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-1009"><a href="#cb26-1009" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">get_taxa_unique</span>(ps_moth, <span class="st">"Family"</span>), <span class="dv">16</span>)</span>
<span id="cb26-1010"><a href="#cb26-1010" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-1011"><a href="#cb26-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1012"><a href="#cb26-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1013"><a href="#cb26-1013" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Source Code {.appendix}</span></span>
<span id="cb26-1014"><a href="#cb26-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1015"><a href="#cb26-1015" aria-hidden="true" tabindex="-1"></a>{{&lt; include /include/_access_code.qmd &gt;}}</span>
<span id="cb26-1016"><a href="#cb26-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1017"><a href="#cb26-1017" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Data Availability {.appendix}</span></span>
<span id="cb26-1018"><a href="#cb26-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1019"><a href="#cb26-1019" aria-hidden="true" tabindex="-1"></a>{{&lt; include /include/_data_availability.qmd &gt;}}</span>
<span id="cb26-1020"><a href="#cb26-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1021"><a href="#cb26-1021" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Last updated on {.appendix}</span></span>
<span id="cb26-1022"><a href="#cb26-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1025"><a href="#cb26-1025" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-1026"><a href="#cb26-1026" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-1027"><a href="#cb26-1027" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb26-1028"><a href="#cb26-1028" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.time</span>()</span>
<span id="cb26-1029"><a href="#cb26-1029" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb26-1030"><a href="#cb26-1030" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Â© Copyright 2024 <a href="https://metacrobe.github.io/">metacrobe</a> &amp; <a href="https://istmobiome.rbind.io/">The Istmobiome Project</a>. Site constructed using <a href="https://quarto.org/">Quarto</a>.</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/istmobiome/trans-shrimp/edit/main/docs/ssu-workflows/compare/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/istmobiome/trans-shrimp/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/istmobiome/trans-shrimp/blob/main/docs/ssu-workflows/compare/index.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


</body></html>